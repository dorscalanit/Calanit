<!DOCTYPE html>
<html lang="he" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>×›×œ× ×™×ª | ×”×‘×™×ª ×©×œ×š ×œ×§×¨×™×™×¨×”</title>
    <!-- Fonts & Styles -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Heebo:wght@400;500;700;900&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://unpkg.com/swiper/swiper-bundle.min.css" />
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.2/css/all.min.css">
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        body { font-family: 'Heebo', sans-serif; scroll-behavior: smooth; }
        .brand-logo { font-weight: 900; font-size: 1.8rem; }
        .hero-gradient { background: linear-gradient(135deg, rgba(59,130,246,1) 0%, rgba(37,99,235,1) 100%); }
        .swiper-pagination-progressbar .swiper-pagination-progressbar-fill { background: #fff !important; }
        .swiper-button-next, .swiper-button-prev { color: white; background-color: rgba(0, 0, 0, 0.3); width: 50px; height: 50px; border-radius: 50%;}
        .swiper-button-next::after, .swiper-button-prev::after { font-size: 20px; }
        .animated-section { opacity: 0; transform: translateY(40px); transition: opacity 0.8s ease-out, transform 0.8s ease-out; }
        .animated-section.is-visible { opacity: 1; transform: translateY(0); }
        .modal { transition: opacity 0.25s ease; }
        .modal-content { transition: transform 0.25s ease; }
    </style>
</head>
<body class="bg-gray-50">

    <!-- Header Placeholder -->
    <header id="header-placeholder" class="bg-white/80 backdrop-blur-md shadow-sm sticky top-0 z-50"></header>

    <main>
        <!-- Hero + ×—×™×¤×•×© -->
        <section class="hero-gradient text-white">
            <div class="container mx-auto px-6 py-24 text-center">
                <h1 class="text-4xl md:text-6xl font-black mb-4 drop-shadow-lg">×”×¦×¢×“ ×”×‘× ×‘×§×¨×™×™×¨×” ×©×œ×š ××ª×—×™×œ ×›××Ÿ</h1>
                <p class="text-lg md:text-xl mb-12 max-w-3xl mx-auto">×›×œ× ×™×ª ××—×‘×¨×ª ×‘×™×Ÿ ×”×›×™×©×¨×•×Ÿ ×©×œ×š ×œ××©×¨×•×ª ×”××•×‘×™×œ×•×ª ×‘××©×§. ×‘×•××• × ××¦× ×™×—×“ ××ª ×”×”×–×“×× ×•×ª ×”×‘××” ×©×œ×›×.</p>
                <div class="max-w-4xl mx-auto bg-white/20 backdrop-blur-sm p-4 rounded-xl shadow-2xl">
                    <form action="jobs.html" class="grid grid-cols-1 md:grid-cols-4 gap-3 items-center">
                        <input type="text" placeholder="×—×™×¤×•×© ×œ×¤×™ ×ª×¤×§×™×“, ×—×‘×¨×”..." class="md:col-span-2 w-full px-4 py-3 rounded-lg text-gray-800 focus:outline-none focus:ring-4 focus:ring-blue-300 transition">
                        <select class="w-full px-4 py-3 rounded-lg text-gray-500 focus:outline-none focus:ring-4 focus:ring-blue-300 transition">
                            <option>×›×œ ×”×ª×—×•××™×</option>
                        </select>
                        <select class="w-full px-4 py-3 rounded-lg text-gray-500 focus:outline-none focus:ring-4 focus:ring-blue-300 transition">
                            <option>×›×œ ×”××–×•×¨×™×</option>
                        </select>
                        <button type="submit" class="md:col-span-4 w-full bg-white text-blue-600 font-bold px-8 py-3 rounded-lg hover:bg-blue-100 transition duration-300 text-lg shadow-md hover:shadow-lg">
                            <i class="fas fa-search"></i> ×—×™×¤×•×© ××©×¨×•×ª
                        </button>
                    </form>
                </div>
            </div>
        </section>

        <!-- ××©×¨×•×ª ×—××•×ª -->
        <section class="py-20 animated-section">
            <div class="container mx-auto px-6">
                <h2 class="text-3xl md:text-4xl font-bold text-center mb-4 text-gray-800">××©×¨×•×ª ×—××•×ª ğŸ”¥</h2>
                <p class="text-center text-gray-600 mb-12 text-lg">×”×–×“×× ×•×™×•×ª ×©××¡×•×¨ ×œ×š ×œ×¤×¡×¤×¡, ××ª×¢×“×›× ×•×ª ×›×œ ×”×–××Ÿ.</p>
                <div class="relative">
                    <div class="swiper job-stories-slider h-[500px] rounded-2xl shadow-2xl bg-white">
                        <div class="swiper-wrapper">
                            <!-- Slides will be populated dynamically by JS -->
                        </div>
                        <div class="swiper-pagination swiper-pagination-progressbar swiper-pagination-horizontal"></div>
                    </div>
                    <div class="swiper-button-next"></div>
                    <div class="swiper-button-prev"></div>
                </div>
            </div>
        </section>

        <!-- ×§×¨×™××” ×œ×¤×¢×•×œ×” - ×©×œ×— ×§×•"×— -->
        <section class="bg-white py-20 animated-section">
            <div class="container mx-auto px-6 text-center">
                <i class="fas fa-file-signature text-5xl text-blue-500 mb-4"></i>
                <h2 class="text-3xl md:text-4xl font-bold text-gray-800 mb-4">×œ× ××¦××ª ××ª ××” ×©×—×™×¤×©×ª?</h2>
                <p class="text-lg text-gray-600 max-w-2xl mx-auto mb-8">××œ ×“××’×”. ×××’×¨ ×”××©×¨×•×ª ×©×œ× ×• ×“×™× ××™ ×•××ª×¢×“×›×Ÿ ×™×•×-×™×•×. ×©×œ×—/×™ ×œ× ×• ××ª ×§×•×¨×•×ª ×”×—×™×™× ×•×”×¦×•×•×ª ×©×œ× ×• ×™××¦× ×¢×‘×•×¨×š ××ª ×”×”×–×“×× ×•×ª ×”×‘××”.</p>
                <button id="open-cv-modal" class="bg-blue-600 text-white font-bold px-10 py-4 rounded-full hover:bg-blue-700 transition-all duration-300 shadow-lg hover:shadow-xl text-xl">
                    <i class="fas fa-paper-plane mr-2"></i> ×©×œ×™×—×ª ×§×•×¨×•×ª ×—×™×™×
                </button>
            </div>
        </section>
    </main>
    
    <!-- Modal ×œ×©×œ×™×—×ª ×§×•"×— -->
    <div id="cv-modal" class="modal fixed inset-0 bg-black bg-opacity-60 flex items-center justify-center p-4 hidden opacity-0 z-50">
        <div class="modal-content bg-white w-full max-w-lg rounded-lg shadow-2xl p-8 transform -translate-y-10 relative">
            <button id="close-cv-modal" class="absolute top-4 left-4 text-gray-400 hover:text-gray-800 text-xl"><i class="fas fa-times"></i></button>
            <h3 class="text-2xl font-bold mb-6 text-center text-blue-700">×©×œ×™×—×ª ×§×•×¨×•×ª ×—×™×™×</h3>
            <form id="cv-form" class="space-y-5">
                <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                    <div>
                        <label class="font-medium text-sm">×©× ×¤×¨×˜×™ <span class="text-red-500">*</span></label>
                        <input type="text" name="firstName" required class="mt-1 w-full border-gray-300 rounded-md shadow-sm px-3 py-2">
                    </div>
                    <div>
                        <label class="font-medium text-sm">×©× ××©×¤×—×” <span class="text-red-500">*</span></label>
                        <input type="text" name="lastName" required class="mt-1 w-full border-gray-300 rounded-md shadow-sm px-3 py-2">
                    </div>
                    <div>
                        <label class="font-medium text-sm">×˜×œ×¤×•×Ÿ <span class="text-red-500">*</span></label>
                        <input type="tel" name="phone" required pattern="^05\d{8}$" placeholder="05XXXXXXXX" class="mt-1 w-full border-gray-300 rounded-md shadow-sm px-3 py-2">
                    </div>
                    <div>
                        <label class="font-medium text-sm">××’×“×¨</label>
                        <select name="gender" class="mt-1 w-full border-gray-300 rounded-md shadow-sm px-3 py-2">
                            <option value="">×‘×—×¨/×™</option>
                            <option value="×–×›×¨">×–×›×¨</option>
                            <option value="× ×§×‘×”">× ×§×‘×”</option>
                            <option value="××—×¨">××—×¨</option>
                        </select>
                    </div>
                    <div>
                        <label class="font-medium text-sm">×’×™×œ</label>
                        <input type="number" name="age" min="14" max="99" class="mt-1 w-full border-gray-300 rounded-md shadow-sm px-3 py-2">
                    </div>
                    <div>
                        <label class="font-medium text-sm">×ª×—×•××™ ×¢× ×™×™×Ÿ</label>
                        <input type="text" name="interests" placeholder="×œ××©×œ: ×©×™×¨×•×ª, ×—×™× ×•×š, ×˜×›× ×•×œ×•×’×™×”..." class="mt-1 w-full border-gray-300 rounded-md shadow-sm px-3 py-2">
                    </div>
                </div>
                <div>
                    <label class="font-medium text-sm block">×§×•×‘×¥ ×§×•×¨×•×ª ×—×™×™× <span class="text-red-500">*</span></label>
                    <input type="file" name="cvFile" required accept=".pdf,.doc,.docx,.png" class="mt-1 w-full">
                    <p class="text-xs text-gray-400 mt-1">×§×‘×¦×™× × ×ª××›×™×: PDF, DOC, DOCX, PNG</p>
                </div>
                <button type="submit" class="w-full bg-blue-600 text-white py-3 rounded-lg font-bold hover:bg-blue-700 transition">×©×œ×—/×™ ×§×•×¨×•×ª ×—×™×™×</button>
                <div id="cv-form-message" class="text-center text-sm mt-3"></div>
            </form>
        </div>
    </div>

    <!-- Footer Placeholder -->
    <footer id="footer-placeholder" class="bg-gray-800 text-white"></footer>

    <!-- Swiper -->
    <script src="https://unpkg.com/swiper/swiper-bundle.min.js"></script>
    <!-- Firebase & JS -->
    <script type="module">
        // ===== Firebase =====
        import { initializeApp } from "https://www.gstatic.com/firebasejs/11.9.1/firebase-app.js";
        import { getFirestore, collection, query, where, orderBy, limit, getDocs, addDoc, serverTimestamp } from "https://www.gstatic.com/firebasejs/11.9.1/firebase-firestore.js";
        import { getStorage, ref, uploadBytes, getDownloadURL } from "https://www.gstatic.com/firebasejs/11.9.1/firebase-storage.js";

        const firebaseConfig = {
            apiKey: "AIzaSyAOKMJabnJ9JGE5CuclCCSjv5Bo3rT49Cw",
            authDomain: "calanit-31a32.firebaseapp.com",
            projectId: "calanit-31a32",
            storageBucket: "calanit-31a32.appspot.com",
            messagingSenderId: "91430351613",
            appId: "1:91430351613:web:ae46b2063f2d4b71428494",
        };
        const app = initializeApp(firebaseConfig);
        const db = getFirestore(app);
        const storage = getStorage(app);

        // ===== ×˜×¢×™× ×ª ×ª×¤×¨×™×˜/×¤×•×˜×¨ =====
        function loadComponent(url, elementId, callback) {
            fetch(url)
                .then(response => {
                    if (!response.ok) throw new Error('Network response was not ok');
                    return response.text();
                })
                .then(data => {
                    document.getElementById(elementId).innerHTML = data;
                    if (callback) callback();
                })
                .catch(error => console.error(`Error loading component from ${url}:`, error));
        }
        loadComponent('menu.html', 'header-placeholder', () => {
            const mobileMenuButton = document.getElementById('mobile-menu-button');
            const mobileMenu = document.getElementById('mobile-menu');
            if (mobileMenuButton && mobileMenu) {
                mobileMenuButton.addEventListener('click', () => {
                    mobileMenu.classList.toggle('hidden');
                });
            }
        });
        loadComponent('footer.html', 'footer-placeholder');

        // ===== ××©×¨×•×ª ×—××•×ª =====
        async function loadHotJobs() {
            const swiperWrapper = document.querySelector('.job-stories-slider .swiper-wrapper');
            if (!swiperWrapper) return;
            swiperWrapper.innerHTML = '<div class="flex justify-center items-center w-full h-60 text-blue-600 text-lg">×˜×•×¢×Ÿ ××©×¨×•×ª...</div>';
            const q = query(
                collection(db, "jobs"),
                where("isHot", "==", true),
                orderBy("createdAt", "desc"),
                limit(10)
            );
            const snapshot = await getDocs(q);
            if (snapshot.empty) {
                swiperWrapper.innerHTML = `
                    <div class="swiper-slide flex flex-col justify-center items-center h-full bg-gray-100 rounded-2xl">
                        <i class="fas fa-fire text-5xl text-red-400 mb-2"></i>
                        <div class="text-lg font-bold text-gray-800">××™×Ÿ ×›×¨×’×¢ ××©×¨×•×ª ×—××•×ª</div>
                        <div class="text-gray-500 text-sm mt-2">× ×¡×” ×©×•×‘ ×××•×—×¨ ×™×•×ª×¨ ××• ×¢×™×™×Ÿ ×‘×›×œ ×”××©×¨×•×ª</div>
                    </div>
                `;
                return;
            }
            swiperWrapper.innerHTML = '';
            snapshot.forEach(doc => {
                const job = doc.data();
                const jobId = doc.id;
                const slide = document.createElement('div');
                slide.className = 'swiper-slide bg-white rounded-2xl shadow-lg flex flex-col justify-between items-start p-6 h-full relative';
                slide.innerHTML = `
                    <div>
                        <div class="text-blue-600 font-bold text-xl mb-2 flex items-center gap-2"><i class="fas fa-fire text-red-400"></i> ${job.title}</div>
                        <div class="text-gray-600 mb-2 text-base">${job.location || ''} â€¢ ${job.type || ''}</div>
                        <div class="text-gray-700 mb-4 line-clamp-3">${job.description ? job.description.substring(0, 160) : ''}${job.description && job.description.length > 160 ? '...' : ''}</div>
                    </div>
                    <button class="open-cv-modal-btn absolute bottom-6 left-6 bg-blue-600 text-white px-5 py-2 rounded-full font-bold shadow-lg hover:bg-blue-700 transition-all text-base" data-job-id="${jobId}" data-job-title="${job.title}">
                        <i class="fas fa-paper-plane ml-2"></i> ×©×œ×—/×™ ×§×•"×— ×œ××©×¨×” ×–×•
                    </button>
                `;
                swiperWrapper.appendChild(slide);
            });
            if (window.hotJobsSwiper) window.hotJobsSwiper.update();
        }

        // ===== ×× ×™××¦×™×” + ×¤×ª×™×—×ª ××•×“×œ =====
        document.addEventListener('DOMContentLoaded', function() {
            // ×× ×™××¦×™×•×ª
            const animatedSections = document.querySelectorAll('.animated-section');
            const observer = new IntersectionObserver((entries) => {
                entries.forEach(entry => {
                    if (entry.isIntersecting) {
                        entry.target.classList.add('is-visible');
                    }
                });
            }, { threshold: 0.1 });
            animatedSections.forEach(section => observer.observe(section));

            // ×˜×¢×™× ×ª ××©×¨×•×ª ×—××•×ª
            loadHotJobs().then(() => {
                window.hotJobsSwiper = new Swiper('.job-stories-slider', {
                    slidesPerView: 1,
                    spaceBetween: 40,
                    loop: false,
                    pagination: { el: '.swiper-pagination', type: 'progressbar' },
                    navigation: { nextEl: '.swiper-button-next', prevEl: '.swiper-button-prev' },
                    breakpoints: { 640: { slidesPerView: 1.2 }, 900: { slidesPerView: 2 }, 1200: { slidesPerView: 2.5 } }
                });
                // ×¤×ª×™×—×ª ××•×“×œ ××›×¤×ª×•×¨×™ "×©×œ×— ×§×•"×—" ×©×œ ×”××©×¨×•×ª
                document.querySelectorAll('.open-cv-modal-btn').forEach(btn => {
                    btn.addEventListener('click', () => openCVModal(btn.dataset.jobId, btn.dataset.jobTitle));
                });
            });

            // ×¤×ª×™×—×ª ××•×“×œ ××”×›×¤×ª×•×¨ ×”×›×œ×œ×™
            document.getElementById('open-cv-modal').addEventListener('click', () => openCVModal());

            // ×¡×’×™×¨×ª ××•×“×œ
            document.getElementById('close-cv-modal').addEventListener('click', closeCVModal);
            document.getElementById('cv-modal').addEventListener('click', function(e) {
                if (e.target === this) closeCVModal();
            });
        });

        // ====== ×œ×•×’×™×§×” ×œ××•×“×œ ×§×•×¨×•×ª ×—×™×™× ======
        let selectedJobId = null;
        let selectedJobTitle = null;

        function openCVModal(jobId, jobTitle) {
            selectedJobId = jobId || null;
            selectedJobTitle = jobTitle || '';
            const modal = document.getElementById('cv-modal');
            modal.classList.remove('hidden');
            setTimeout(() => {
                modal.classList.remove('opacity-0');
                modal.querySelector('.modal-content').classList.remove('-translate-y-10');
            }, 10);
            // ×”×¦×’×ª ×©× ××©×¨×” (×× ×§×™×™×)
            document.getElementById('cv-form').reset();
            document.getElementById('cv-form-message').innerHTML = "";
            if (jobTitle) {
                document.querySelector('#cv-modal h3').textContent = `×©×œ×™×—×ª ×§×•"×— ×œ××©×¨×ª "${jobTitle}"`;
            } else {
                document.querySelector('#cv-modal h3').textContent = "×©×œ×™×—×ª ×§×•×¨×•×ª ×—×™×™×";
            }
        }
        function closeCVModal() {
            const modal = document.getElementById('cv-modal');
            modal.classList.add('opacity-0');
            modal.querySelector('.modal-content').classList.add('-translate-y-10');
            setTimeout(() => modal.classList.add('hidden'), 250);
        }

        // ×˜×™×¤×•×œ ×‘×©×œ×™×—×ª ×˜×•×¤×¡
        document.addEventListener('DOMContentLoaded', () => {
            document.getElementById('cv-form').addEventListener('submit', async function (e) {
                e.preventDefault();
                const form = e.target;
                const msg = document.getElementById('cv-form-message');
                msg.innerHTML = "";
                // ×•×œ×™×“×¦×™×” ×‘×¡×™×¡×™×ª
                if (!form.cvFile.files[0]) {
                    msg.innerHTML = '<span class="text-red-600">×—×•×‘×” ×œ×”×¢×œ×•×ª ×§×•×‘×¥ ×§×•×¨×•×ª ×—×™×™×.</span>';
                    return;
                }
                const allowed = ['application/pdf', 'application/msword', 'application/vnd.openxmlformats-officedocument.wordprocessingml.document', 'image/png'];
                if (!allowed.includes(form.cvFile.files[0].type)) {
                    msg.innerHTML = '<span class="text-red-600">×§×•×‘×¥ ×œ× × ×ª××š. ×¨×§ PDF / Word / PNG</span>';
                    return;
                }
                msg.innerHTML = '<span class="text-blue-600">××¢×œ×” ×§×•×‘×¥...</span>';

                // ×©×œ×‘ 1: ×”×¢×œ××ª ×§×•×‘×¥ ×œÖ¾Firebase Storage
                const file = form.cvFile.files[0];
                const storageRef = ref(storage, `cvs/${Date.now()}_${file.name}`);
                try {
                    await uploadBytes(storageRef, file);
                    const fileURL = await getDownloadURL(storageRef);

                    // ×©×œ×‘ 2: ×©××™×¨×ª ×”×¤×¨×˜×™× ×‘Ö¾Firestore
                    const docData = {
                        firstName: form.firstName.value,
                        lastName: form.lastName.value,
                        phone: form.phone.value,
                        gender: form.gender.value,
                        age: form.age.value,
                        interests: form.interests.value,
                        fileURL,
                        jobId: selectedJobId || null,
                        jobTitle: selectedJobTitle || null,
                        createdAt: serverTimestamp()
                    };
                    await addDoc(collection(db, "jobApplicants"), docData);
                    msg.innerHTML = '<span class="text-green-600">×”×§×•×‘×¥ × ×©×œ×— ×‘×”×¦×œ×—×”! × ×—×–×•×¨ ××œ×™×š ×‘×”×§×“× ğŸ™Œ</span>';
                    form.reset();
                    setTimeout(closeCVModal, 2000);
                } catch (err) {
                    msg.innerHTML = '<span class="text-red-600">××™×¨×¢×” ×©×’×™××”, × ×¡×” ×©× ×™×ª ××• ×¦×•×¨ ×§×©×¨.</span>';
                }
            });
        });
    </script>
</body>
</html>