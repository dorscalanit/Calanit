<!DOCTYPE html>
<html lang="he" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>×›×œ× ×™×ª | ×”×‘×™×ª ×©×œ×š ×œ×§×¨×™×™×¨×”</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Heebo:wght@400;500;700;900&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://unpkg.com/swiper/swiper-bundle.min.css" />
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.2/css/all.min.css">
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        body { font-family: 'Heebo', sans-serif; scroll-behavior: smooth; background-color: #f8fafc; }
        .brand-logo { font-weight: 900; font-size: 1.8rem; }
        .hero-gradient { background: linear-gradient(135deg, #3b82f6 0%, #1d4ed8 100%); }
        .story-slider-container .swiper { height: 480px; border-radius: 1.5rem; box-shadow: 0 10px 25px -5px rgba(0,0,0,0.1); position: relative; overflow: hidden; }
        .story-slider-container .swiper-slide { color: white; display: flex; flex-direction: column; justify-content: flex-end; padding: 2rem; background-size: cover; background-position: center; }
        .story-slider-container .story-overlay { position: absolute; inset: 0; background: linear-gradient(to top, rgba(0,0,0,0.8) 0%, rgba(0,0,0,0.4) 40%, rgba(0,0,0,0) 100%); }
        .story-slider-container .story-content { position: relative; z-index: 10; }
        .story-slider-container .swiper-pagination-progressbar { top: 0 !important; bottom: auto !important; height: 4px !important; background: rgba(255,255,255,0.3) !important; }
        .story-slider-container .swiper-pagination-progressbar-fill { background: #fff !important; }
        .story-slider-container .swiper-button-next, .story-slider-container .swiper-button-prev { color: white; background-color: rgba(0,0,0,0.2); width: 50px; height: 50px; border-radius: 50%; transition: background-color 0.2s ease; }
        .story-slider-container .swiper-button-next:hover, .story-slider-container .swiper-button-prev:hover { background-color: rgba(0,0,0,0.4); }
        .story-slider-container .swiper-button-next::after, .story-slider-container .swiper-button-prev::after { font-size: 20px; font-weight: bold; }
        .animated-section { opacity: 0; transform: translateY(50px); transition: opacity 0.6s ease-out, transform 0.6s ease-out; }
        .animated-section.is-visible { opacity: 1; transform: translateY(0); }
        .modal { transition: opacity 0.3s ease; }
        .modal-content { transition: transform 0.3s ease, opacity 0.3s ease; }
        .autocomplete-item:hover { background-color: #eef2ff; }
        select:disabled { background-color: #e5e7eb; cursor: not-allowed; }
    </style>
</head>
<body class="text-gray-800">
    <header id="header-placeholder"></header>

    <main>
        <section class="hero-gradient text-white">
            <div class="container mx-auto px-6 pt-20 pb-24 text-center">
                <h1 class="text-4xl md:text-6xl font-black mb-4 drop-shadow-md">×”×¦×¢×“ ×”×‘× ×‘×§×¨×™×™×¨×” ×©×œ×š ××ª×—×™×œ ×›××Ÿ</h1>
                <p class="text-lg md:text-xl mb-12 max-w-3xl mx-auto opacity-90">×›×œ× ×™×ª ××—×‘×¨×ª ×‘×™×Ÿ ×”×›×™×©×¨×•×Ÿ ×©×œ×š ×œ××©×¨×•×ª ×”××•×‘×™×œ×•×ª ×‘××©×§. ×‘×•××• × ××¦× ×™×—×“ ××ª ×”×”×–×“×× ×•×ª ×”×‘××” ×©×œ×›×.</p>
                <div class="max-w-5xl mx-auto bg-white/20 backdrop-blur-sm p-4 rounded-xl shadow-2xl">
                    <div id="search-form" class="grid grid-cols-1 md:grid-cols-4 gap-4 items-start">
                        <input type="text" id="keyword-search-input" placeholder="×œ×“×•×’××: 40 ×©×§×œ×™× ×œ×©×¢×”, ××¤×ª×— Full-Stack..." class="md:col-span-4 w-full px-4 py-3 rounded-lg text-gray-800 border-2 border-transparent focus:outline-none focus:ring-4 focus:ring-blue-300 transition-all duration-300" />
                        <div class="relative md:col-span-2"><input type="text" id="location-search-input" placeholder="×”×§×œ×“/×™ ××–×•×¨ ××• ×¢×™×¨..." autocomplete="off" class="w-full px-4 py-3 rounded-lg text-gray-800 border-2 border-transparent focus:outline-none focus:ring-4 focus:ring-blue-300 transition-all duration-300"><div id="autocomplete-results" class="absolute top-full left-0 right-0 bg-white border border-gray-300 rounded-b-lg shadow-lg z-20 hidden max-h-60 overflow-y-auto text-right"></div></div>
                        <div class="relative"><select id="main-category-select" class="w-full px-4 py-3 rounded-lg text-gray-500 border-2 border-transparent focus:outline-none focus:ring-4 focus:ring-blue-300 transition-all duration-300"><option value="">×‘×—×¨/×™ ×ª×—×•× ×¨××©×™</option></select></div>
                        <div class="relative"><select id="subcategory-select" disabled class="w-full px-4 py-3 rounded-lg text-gray-500 border-2 border-transparent focus:outline-none focus:ring-4 focus:ring-blue-300 transition-all duration-300"><option value="">×‘×—×¨/×™ ×ª×ª ×§×˜×’×•×¨×™×”</option></select></div>
                        <div class="md:col-span-4 flex flex-col md:flex-row gap-4 mt-2 px-2 min-h-[40px]"><div id="selected-locations-container" class="flex flex-wrap gap-2 items-center justify-center md:justify-start flex-grow"></div><div id="selected-categories-container" class="flex flex-wrap gap-2 items-center justify-center md:justify-start flex-grow"></div></div>
                        <button id="search-button" class="md:col-span-4 w-full bg-white text-blue-600 font-bold px-8 py-3 rounded-lg hover:bg-blue-100 transition duration-300 text-lg shadow-md hover:shadow-lg mt-2"><i class="fas fa-search"></i><span class="ml-2">×—×™×¤×•×© ××©×¨×•×ª</span></button>
                    </div>
                </div>
            </div>
        </section>

        <!-- Dynamic Sections: Hot Jobs, New Jobs, etc. -->
        <section class="py-24 animated-section">
            <div class="container mx-auto px-6">
                <div class="text-center mb-16"><h2 class="text-3xl md:text-4xl font-bold mb-3 text-gray-900">××©×¨×•×ª ×—××•×ª ğŸ”¥</h2><p class="text-lg text-gray-600">×”×–×“×× ×•×™×•×ª ×©××¡×•×¨ ×œ×›× ×œ×¤×¡×¤×¡, ××ª×¢×“×›× ×•×ª ×›×œ ×”×–××Ÿ.</p></div>
                <div class="relative story-slider-container" id="hot-jobs-container"><div class="swiper hot-jobs-slider"><div class="swiper-wrapper"></div><div class="swiper-button-next"></div><div class="swiper-button-prev"></div><div class="swiper-pagination swiper-pagination-progressbar swiper-pagination-horizontal"></div></div></div>
            </div>
        </section>
        <section class="bg-white py-24 animated-section">
            <div class="container mx-auto px-6">
                <div class="text-center mb-16"><h2 class="text-3xl md:text-4xl font-bold mb-3 text-gray-900">××©×¨×•×ª ×—×“×©×•×ª âœ¨</h2><p class="text-lg text-gray-600">×”×”×–×“×× ×•×™×•×ª ×”××—×¨×•× ×•×ª ×©×”×¦×˜×¨×¤×• ×œ×××’×¨ ×©×œ× ×•.</p></div>
                <div class="relative story-slider-container" id="new-jobs-container"><div class="swiper new-jobs-slider"><div class="swiper-wrapper"></div><div class="swiper-button-next"></div><div class="swiper-button-prev"></div><div class="swiper-pagination swiper-pagination-progressbar swiper-pagination-horizontal"></div></div></div>
            </div>
        </section>
        <section id="send-cv-section" class="py-24 animated-section">
            <div class="container mx-auto px-6 text-center">
                <div class="max-w-3xl mx-auto"><i class="fas fa-file-signature text-6xl text-blue-500 mb-6"></i><h2 class="text-3xl md:text-4xl font-bold text-gray-900 mb-4">×œ× ××¦××ª× ××ª ××” ×©×—×™×¤×©×ª×?</h2><p class="text-lg text-gray-600 mb-8">×©×œ×—×• ×œ× ×• ××ª ×§×•×¨×•×ª ×”×—×™×™× ×•×”×¦×•×•×ª ×”××§×¦×•×¢×™ ×©×œ× ×• ×™××¦× ×¢×‘×•×¨×›× ××ª ×”×”×–×“×× ×•×ª ×”×‘××”.</p><button id="open-cv-modal" class="bg-blue-600 text-white font-bold px-10 py-4 rounded-full hover:bg-blue-700 transition-all duration-300 shadow-lg hover:shadow-xl transform hover:scale-105 text-xl"><i class="fas fa-paper-plane mr-3"></i> ×©×œ×™×—×ª ×§×•×¨×•×ª ×—×™×™×</button></div>
            </div>
        </section>
    </main>

    <div id="cv-modal-container"></div>
    <footer id="footer-placeholder"></footer>
    <script src="https://unpkg.com/swiper/swiper-bundle.min.js"></script>
    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-app.js";
        import { getFirestore, collection, query, where, getDocs, orderBy } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-firestore.js";
        
        const firebaseConfig = { apiKey: "AIzaSyAOKMJabnJ9JGE5CuclCCSjv5Bo3rT49Cw", authDomain: "calanit-31a32.firebaseapp.com", projectId: "calanit-31a32", storageBucket: "calanit-31a32.appspot.com", messagingSenderId: "91430351613", appId: "1:91430351613:web:ae46b2063f2d4b71428494" };
        const app = initializeApp(firebaseConfig);
        const db = getFirestore(app);

        let allCities = [], jobTypesData = {}, selectedLocations = new Set(), selectedCategories = new Set();

        async function loadJsonData(filePath, fallback) { try { const res = await fetch(filePath); return res.ok ? res.json() : fallback; } catch (e) { console.error(`Failed to load ${filePath}:`, e); return fallback; } }
        function loadComponent(url, id, cb) { fetch(url).then(res => res.ok ? res.text() : Promise.reject()).then(html => { document.getElementById(id).innerHTML = html; if (cb) cb(); }).catch(err => console.error(`Failed loading ${url}`)); }

        function setupFilterBubbles(config) {
            const { input, resultsContainer, bubblesContainer, dataSet, selectedSet } = config;
            input.addEventListener('input', () => {
                const query = input.value.trim();
                if (query.length < 2) { resultsContainer.classList.add('hidden'); return; }
                const filtered = dataSet.filter(c => c.startsWith(query) && !selectedSet.has(c)).slice(0, 7);
                resultsContainer.innerHTML = '';
                if(filtered.length) {
                    filtered.forEach(itemText => {
                        const item = document.createElement('div');
                        item.className = 'p-3 text-gray-800 cursor-pointer autocomplete-item';
                        item.textContent = itemText;
                        item.addEventListener('click', () => addItem(itemText));
                        resultsContainer.appendChild(item);
                    });
                    resultsContainer.classList.remove('hidden');
                } else { resultsContainer.classList.add('hidden'); }
            });
            const addItem = (item) => { if (item && !selectedSet.has(item)) { selectedSet.add(item); renderBubbles(); } input.value = ''; resultsContainer.classList.add('hidden'); };
            const removeItem = (item) => { selectedSet.delete(item); renderBubbles(); };
            const renderBubbles = () => {
                bubblesContainer.innerHTML = '';
                const bubbleColor = config.color || 'blue';
                selectedSet.forEach(item => {
                    const bubble = document.createElement('div');
                    bubble.className = `bg-${bubbleColor}-500 text-white text-sm font-semibold px-3 py-1.5 rounded-full flex items-center gap-2`;
                    bubble.innerHTML = `<span>${item}</span><button type="button" class="bg-${bubbleColor}-600 hover:bg-${bubbleColor}-700 rounded-full w-5 h-5 flex items-center justify-center text-xs transition-colors">&times;</button>`;
                    bubble.querySelector('button').addEventListener('click', () => removeItem(item));
                    bubblesContainer.appendChild(bubble);
                });
            };
            document.addEventListener('click', e => { if (!input.contains(e.target)) resultsContainer.classList.add('hidden'); });
        }

        function setupCategoryFilter() {
            const mainSelect = document.getElementById('main-category-select');
            const subSelect = document.getElementById('subcategory-select');
            Object.keys(jobTypesData).sort().forEach(cat => mainSelect.add(new Option(cat, cat)));
            mainSelect.addEventListener('change', () => {
                const selectedMain = mainSelect.value;
                subSelect.innerHTML = '<option value="">×‘×—×¨/×™ ×ª×ª ×§×˜×’×•×¨×™×”</option>';
                if (selectedMain && jobTypesData[selectedMain]) {
                    jobTypesData[selectedMain].forEach(sub => subSelect.add(new Option(sub, sub)));
                    subSelect.disabled = false;
                } else { subSelect.disabled = true; }
            });
            subSelect.addEventListener('change', () => {
                if (subSelect.value) {
                    selectedCategories.add(subSelect.value);
                    document.getElementById('selected-categories-container').dispatchEvent(new Event('render'));
                    subSelect.value = "";
                }
            });
        }
        
        async function createStorySlider(config) {
            const swiperWrapper = document.querySelector(`${config.containerId} .swiper-wrapper`);
            if (!swiperWrapper) return;
            swiperWrapper.innerHTML = `<div class="swiper-slide bg-gray-200"><div class="story-content text-center text-gray-600"><i class="fas fa-spinner fa-spin text-4xl"></i></div></div>`;
            try {
                const snapshot = await getDocs(config.query);
                if (snapshot.empty) { swiperWrapper.innerHTML = `<div class="swiper-slide bg-gray-200"><div class="story-overlay"></div><div class="story-content"><h3 class="text-3xl font-bold">${config.noJobsMessage}</h3></div></div>`; return; }
                swiperWrapper.innerHTML = '';
                snapshot.forEach(doc => {
                    const job = doc.data();
                    const imageUrl = job.imageUrl || `https://placehold.co/800x500/3b82f6/ffffff?text=${encodeURIComponent(job.title)}`;
                    const slide = document.createElement('div');
                    slide.className = 'swiper-slide';
                    slide.style.backgroundImage = `url('${imageUrl}')`;
                    slide.innerHTML = `<div class="story-overlay"></div><div class="story-content w-full"><h3 class="text-3xl md:text-4xl font-black drop-shadow-lg flex items-center gap-3"><i class="${config.jobIconClass}"></i> ${job.title || ''}</h3><div class="text-lg font-medium mt-2 mb-6 opacity-90"><i class="fas fa-map-marker-alt ml-1"></i> ${job.locations ? job.locations.join(', ') : ''}</div></div>`;
                    swiperWrapper.appendChild(slide);
                });
                new Swiper(`${config.containerId} .swiper`, { slidesPerView: 1, effect: 'fade', loop: snapshot.size > 1, autoplay: { delay: 7000 }, pagination: { el: `${config.containerId} .swiper-pagination`, type: 'progressbar' }, navigation: { nextEl: `${config.containerId} .swiper-button-next`, prevEl: `${config.containerId} .swiper-button-prev` } });
            } catch (error) { console.error(`Error loading jobs for ${config.containerId}:`, error); }
        }

        document.addEventListener('DOMContentLoaded', async () => {
            loadComponent('menu.html', 'header-placeholder', () => { document.getElementById('mobile-menu-button')?.addEventListener('click', () => document.getElementById('mobile-menu')?.classList.toggle('hidden')); });
            loadComponent('footer.html', 'footer-placeholder');
            loadComponent('cv-modal.html', 'cv-modal-container');

            [allCities, jobTypesData] = await Promise.all([ loadJsonData('cities.json', []), loadJsonData('jobTypesHierarchical.json', {}) ]);

            setupFilterBubbles({ input: document.getElementById('location-search-input'), resultsContainer: document.getElementById('autocomplete-results'), bubblesContainer: document.getElementById('selected-locations-container'), dataSet: allCities, selectedSet: selectedLocations, color: 'blue' });
            setupCategoryFilter();
            const categoriesContainer = document.getElementById('selected-categories-container');
            categoriesContainer.addEventListener('render', () => {
                categoriesContainer.innerHTML = '';
                selectedCategories.forEach(item => {
                    const bubble = document.createElement('div');
                    bubble.className = `bg-green-500 text-white text-sm font-semibold px-3 py-1.5 rounded-full flex items-center gap-2`;
                    bubble.innerHTML = `<span>${item}</span><button type="button" class="bg-green-600 hover:bg-green-700 rounded-full w-5 h-5 flex items-center justify-center text-xs transition-colors">&times;</button>`;
                    bubble.querySelector('button').addEventListener('click', () => { selectedCategories.delete(item); categoriesContainer.dispatchEvent(new Event('render')); });
                    categoriesContainer.appendChild(bubble);
                });
            });

            const hotJobsQuery = query(collection(db, "jobs"), where("isHot", "==", true));
            createStorySlider({ containerId: '#hot-jobs-container', query: hotJobsQuery, noJobsMessage: '××™×Ÿ ×›×¨×’×¢ ××©×¨×•×ª ×—××•×ª', jobIconClass: 'fas fa-fire text-red-400' });
            
            const sevenDaysAgo = new Date(Date.now() - 7 * 24 * 60 * 60 * 1000);
            const newJobsQuery = query(collection(db, "jobs"), where("createdAt", ">=", sevenDaysAgo), orderBy("createdAt", "desc"));
            createStorySlider({ containerId: '#new-jobs-container', query: newJobsQuery, noJobsMessage: '××™×Ÿ ××©×¨×•×ª ××”×©×‘×•×¢ ×”××—×¨×•×Ÿ', jobIconClass: 'fas fa-sparkles text-yellow-300' });
            
            document.getElementById('search-button').addEventListener('click', () => {
                const params = new URLSearchParams();
                const keyword = document.getElementById('keyword-search-input').value;
                if(keyword) params.append('keyword', keyword);
                if(selectedLocations.size > 0) params.append('locations', Array.from(selectedLocations).join(','));
                if(selectedCategories.size > 0) params.append('categories', Array.from(selectedCategories).join(','));
                
                window.location.href = `jobs.html?${params.toString()}`;
            });

            document.querySelectorAll('.animated-section').forEach(el => new IntersectionObserver((entries) => { if(entries[0].isIntersecting) el.classList.add('is-visible'); }, {threshold: 0.1}).observe(el));
        });
    </script>
</body>
</html>

