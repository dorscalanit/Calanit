<!DOCTYPE html>
<html lang="he" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title data-translate-key="home_page_title">×›×œ× ×™×ª | ×”×‘×™×ª ×©×œ×š ×œ×§×¨×™×™×¨×”</title>

    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Heebo:wght@400;500;700;900&display=swap" rel="stylesheet">

    <link rel="stylesheet" href="https://unpkg.com/swiper/swiper-bundle.min.css"/>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.2/css/all.min.css">
    <script src="https://cdn.tailwindcss.com"></script>

    <style>
        body { font-family: 'Heebo', sans-serif; scroll-behavior: smooth; background-color: #f8fafc; color: #1a202c; }
        .hero-gradient { background-color: #0f766e; background-image: linear-gradient(135deg, #14b8a6 0%, #0d9488 100%); }

        .story-slider-container .swiper { height: 480px; border-radius: 1.5rem; box-shadow: 0 10px 25px -5px rgba(0,0,0,0.07); position: relative; overflow: hidden; }
        .story-slider-container .swiper-slide { color: white; display: flex; flex-direction: column; justify-content: flex-end; padding: 2rem; background-size: cover; background-position: center; }
        .story-slider-container .story-overlay { position: absolute; inset: 0; background: linear-gradient(to top, rgba(0,0,0,0.75) 0%, rgba(0,0,0,0.3) 40%, rgba(0,0,0,0) 100%); }
        .story-slider-container .story-content { position: relative; z-index: 10; }

        .story-slider-container .swiper-pagination-progressbar { top: 0 !important; bottom: auto !important; height: 4px !important; background: rgba(255,255,255,0.3) !important; }
        .story-slider-container .swiper-pagination-progressbar-fill { background: #fff !important; }
        .story-slider-container .swiper-button-next, .story-slider-container .swiper-button-prev { color: white; background-color: rgba(0,0,0,0.25); width: 44px; height: 44px; border-radius: 50%; transition: background-color 0.2s ease; }
        .story-slider-container .swiper-button-next:hover, .story-slider-container .swiper-button-prev:hover { background-color: rgba(0,0,0,0.5); }
        .story-slider-container .swiper-button-next::after, .story-slider-container .swiper-button-prev::after { font-size: 18px; }

        .animated-section { opacity: 0; transform: translateY(40px); transition: opacity 0.8s ease-out, transform 0.8s ease-out; }
        .animated-section.is-visible { opacity: 1; transform: translateY(0); }

        .autocomplete-item:hover { background-color: #f0fdfa; }
        select:disabled { background-color: #e5e7eb; cursor: not-allowed; }
        .bubble-location { background-color: #cffafe; color: #0e7490; }
        .bubble-category { background-color: #d1fae5; color: #065f46; }

        .lang-btn-menu.active { background-color: #14b8a6; color: white; }
        .modal { transition: opacity 0.3s ease; }
        .modal-content { transition: transform 0.3s ease, opacity 0.3s ease; }
        .modal.opacity-0 { pointer-events: none; }

        .partners-section { background: #fff; border-top: 1px solid #e2e8f0; padding: 56px 0 48px 0; }
        .partners-title { font-size: 2rem; font-weight: 700; color: #334155; text-align: center; margin-bottom: 2.5rem; }
        .partners-marquee-container { overflow: hidden; width: 100%; position: relative; height: 110px; }
        .partners-marquee-track { display: flex; align-items: center; gap: 64px; will-change: transform; animation: marquee-rtl 24s linear infinite; }
        .partners-marquee-track:hover { animation-play-state: paused; }
        .partner-logo-wrapper { flex: 0 0 auto; display: flex; align-items: center; justify-content: center; }
        .partner-logo-img { height: 64px; width: auto; object-fit: contain; filter: grayscale(1); opacity: 0.7; transition: all .3s; }
        .partner-logo-img:hover { filter: grayscale(0); opacity: 1; transform: scale(1.1); }
        @keyframes marquee-rtl { 0% { transform: translateX(0); } 100% { transform: translateX(-50%); } }
        @media (max-width: 640px) {
            .partners-title { font-size: 1.5rem; }
            .partners-marquee-track { gap: 48px; }
            .partners-marquee-container { height: 75px; }
            .partner-logo-img { height: 40px; }
        }

        #search-form-container { transition: all 0.3s ease-in-out; max-height: 0; overflow: hidden; }
        #search-form-container.active { max-height: 500px; }

        .input-error { border-color: #ef4444 !important; }
    </style>
</head>
<body class="text-gray-800">
<header id="header-placeholder"></header>

<main>
    <!-- HERO -->
    <section class="hero-gradient text-white">
        <div class="container mx-auto px-6 pt-24 pb-28 text-center">
            <h1 class="text-4xl md:text-6xl font-black mb-4 drop-shadow-md" data-translate-key="hero_title">×”×¦×¢×“ ×”×‘× ×‘×§×¨×™×™×¨×” ×©×œ×š ××ª×—×™×œ ×›××Ÿ</h1>
            <p class="text-lg md:text-xl mb-12 max-w-3xl mx-auto opacity-90" data-translate-key="hero_subtitle">××©×¨×•×ª ×—×“×©×•×ª ××”×—×‘×¨×•×ª ×”××•×‘×™×œ×•×ª ×‘××©×§, ××—×›×•×ª ×¨×§ ×œ×š.</p>

            <div id="hero-search-wrapper" class="flex flex-col items-center gap-4">
                <!-- Inline search -->
                <div id="search-form-container" class="w-full max-w-5xl">
                    <div class="bg-white/10 backdrop-blur-sm p-4 rounded-2xl shadow-2xl">
                        <div id="search-form" class="grid grid-cols-1 md:grid-cols-2 gap-x-6 gap-y-4 items-start">
                            <input type="text" id="keyword-search-input" data-translate-key="placeholder_keyword" placeholder="×œ×“×•×’××: ××¤×ª×— Full-Stack..." class="md:col-span-2 w-full px-4 py-3 rounded-lg text-gray-800 bg-white border-gray-200 border focus:outline-none focus:ring-2 focus:ring-teal-400 focus:border-teal-400"/>

                            <div class="relative">
                                <label class="font-semibold text-sm mb-1 block text-left">××™×§×•×</label>
                                <input type="text" id="location-search-input" data-translate-key="placeholder_location" placeholder="×”×§×œ×“/×™ ×¢×™×¨..." autocomplete="off" class="w-full px-4 py-3 rounded-lg text-gray-800 bg-white border-gray-200 border focus:outline-none focus:ring-2 focus:ring-teal-400 focus:border-teal-400">
                                <div id="autocomplete-results" class="absolute top-full left-0 right-0 bg-white border rounded-b-lg shadow-lg z-20 hidden max-h-60 overflow-y-auto text-right"></div>
                            </div>

                            <div class="relative">
                                <label class="font-semibold text-sm mb-1 block text-left">×ª×—×•×</label>
                                <select id="main-category-select" class="w-full px-4 py-3 rounded-lg text-gray-800 bg-white border-gray-200 border focus:outline-none focus:ring-2 focus:ring-teal-400 focus:border-teal-400">
                                    <option value="" data-translate-key="select_main_category">×‘×—×¨/×™ ×ª×—×•× ×¨××©×™</option>
                                </select>
                            </div>

                            <div class="md:col-span-2">
                                <div id="selected-locations-container" class="flex flex-wrap gap-2 items-center min-h-[2.5rem]"></div>
                            </div>

                            <div class="relative">
                                <select id="subcategory-select" disabled class="w-full px-4 py-3 rounded-lg text-gray-800 bg-white border-gray-200 border focus:outline-none focus:ring-2 focus:ring-teal-400 focus:border-teal-400">
                                    <option value="" data-translate-key="select_subcategory">×‘×—×¨/×™ ×ª×ª ×§×˜×’×•×¨×™×”</option>
                                </select>
                            </div>

                            <div class="md:col-span-2">
                                <div id="selected-categories-container" class="flex flex-wrap gap-2 items-center min-h-[2.5rem]"></div>
                            </div>

                            <button id="search-button" class="md:col-span-2 w-full bg-white text-teal-600 font-bold px-8 py-3 rounded-lg hover:bg-teal-50 transition duration-300 text-lg shadow-md hover:shadow-lg">
                                <i class="fas fa-search"></i>
                                <span class="ml-2" data-translate-key="search_jobs_button">×—×™×¤×•×© ××©×¨×•×ª</span>
                            </button>
                        </div>
                    </div>
                </div>

                <div id="initial-buttons" class="flex flex-col sm:flex-row justify-center items-center gap-4">
                    <button id="open-search-btn" class="w-full sm:w-auto bg-white text-teal-600 font-bold px-8 py-4 rounded-full hover:bg-teal-50 transition duration-300 text-lg shadow-lg hover:shadow-xl transform hover:scale-105">
                        <i class="fas fa-search"></i>
                        <span class="ml-2" data-translate-key="search_jobs_button">×—×¤×© ××©×¨×”</span>
                    </button>
                    <a href="jobs.html" class="w-full sm:w-auto bg-white/20 text-white font-bold px-8 py-4 rounded-full hover:bg-white/30 transition duration-300 text-lg backdrop-blur-sm">
                        <span data-translate-key="nav_all_jobs">×œ×›×œ ×”××©×¨×•×ª</span>
                        <i class="fas fa-arrow-left mr-2"></i>
                    </a>
                </div>
            </div>
        </div>
    </section>

    <!-- CATEGORIES -->
    <section class="py-24 bg-white animated-section">
        <div class="container mx-auto px-6">
            <div class="text-center mb-16">
                <h2 class="text-3xl md:text-4xl font-bold mb-3" data-translate-key="category_section_title">×—×™×¤×•×© ×œ×¤×™ ×ª×—×•×</h2>
                <p class="text-lg text-gray-600" data-translate-key="category_section_subtitle">××¦×/×™ ××ª ×”××©×¨×” ×”×‘××” ×©×œ×š ×‘×§×œ×•×ª.</p>
            </div>

            <div class="grid grid-cols-2 sm:grid-cols-3 lg:grid-cols-6 gap-6 text-center">
                <a href="jobs.html?categories=×‘×™×˜×—×•×Ÿ" class="group block bg-white p-6 rounded-2xl shadow-md hover:shadow-xl hover:-translate-y-2 transition-all duration-300 border border-transparent hover:border-blue-200">
                    <div class="flex items-center justify-center h-20 w-20 mx-auto rounded-full bg-blue-100 text-blue-600"><i class="fas fa-shield-halved text-4xl"></i></div>
                    <h3 class="font-bold mt-4 text-lg text-gray-800" data-translate-key="cat_security">×‘×™×˜×—×•×Ÿ</h3>
                </a>
                <a href="jobs.html?categories=× ×”×’×™×" class="group block bg-white p-6 rounded-2xl shadow-md hover:shadow-xl hover:-translate-y-2 transition-all duration-300 border border-transparent hover:border-orange-200">
                    <div class="flex items-center justify-center h-20 w-20 mx-auto rounded-full bg-orange-100 text-orange-600"><i class="fas fa-car text-4xl"></i></div>
                    <h3 class="font-bold mt-4 text-lg text-gray-800" data-translate-key="cat_drivers">× ×”×’×™×</h3>
                </a>
                <a href="jobs.html?categories=×™×¦×•×¨ ×•×ª×¢×©×™×™×”" class="group block bg-white p-6 rounded-2xl shadow-md hover:shadow-xl hover:-translate-y-2 transition-all duration-300 border border-transparent hover:border-gray-300">
                    <div class="flex items-center justify-center h-20 w-20 mx-auto rounded-full bg-gray-200 text-gray-700"><i class="fas fa-industry text-4xl"></i></div>
                    <h3 class="font-bold mt-4 text-lg text-gray-800" data-translate-key="cat_manufacturing">×™×¦×•×¨ ×•×ª×¢×©×™×™×”</h3>
                </a>
                <a href="jobs.html?categories=× ×™×§×™×•×Ÿ" class="group block bg-white p-6 rounded-2xl shadow-md hover:shadow-xl hover:-translate-y-2 transition-all duration-300 border border-transparent hover:border-green-200">
                    <div class="flex items-center justify-center h-20 w-20 mx-auto rounded-full bg-green-100 text-green-600"><i class="fas fa-broom text-4xl"></i></div>
                    <h3 class="font-bold mt-4 text-lg text-gray-800" data-translate-key="cat_cleaning">× ×™×§×™×•×Ÿ</h3>
                </a>
                <a href="jobs.html?categories=××—×¡× ×™×" class="group block bg-white p-6 rounded-2xl shadow-md hover:shadow-xl hover:-translate-y-2 transition-all duration-300 border border-transparent hover:border-purple-200">
                    <div class="flex items-center justify-center h-20 w-20 mx-auto rounded-full bg-purple-100 text-purple-600"><i class="fas fa-warehouse text-4xl"></i></div>
                    <h3 class="font-bold mt-4 text-lg text-gray-800" data-translate-key="cat_warehouse">××—×¡× ×™×</h3>
                </a>
                <a href="javascript:void(0);" onclick="window.openCVModal()" class="group block bg-white p-6 rounded-2xl shadow-md hover:shadow-xl hover:-translate-y-2 transition-all duration-300 border border-transparent hover:border-teal-200">
                    <div class="flex items-center justify-center h-20 w-20 mx-auto rounded-full bg-teal-100 text-teal-600"><i class="fas fa-paper-plane text-4xl"></i></div>
                    <h3 class="font-bold mt-4 text-lg text-gray-800" data-translate-key="cat_no_experience">×œ×œ× × ×™×¡×™×•×Ÿ</h3>
                </a>
            </div>
        </div>
    </section>

    <!-- HOT JOBS -->
    <section class="py-24 animated-section">
        <div class="container mx-auto px-6">
            <div class="text-center mb-16">
                <h2 class="text-3xl md:text-4xl font-bold mb-3" data-translate-key="hot_jobs_title">××©×¨×•×ª ×—××•×ª ğŸ”¥</h2>
                <p class="text-lg text-gray-600" data-translate-key="hot_jobs_subtitle">×”×–×“×× ×•×™×•×ª ×©××¡×•×¨ ×œ×›× ×œ×¤×¡×¤×¡.</p>
            </div>

            <div class="relative story-slider-container" id="hot-jobs-container">
                <div class="swiper hot-jobs-slider">
                    <div class="swiper-wrapper"></div>
                    <div class="swiper-button-next"></div>
                    <div class="swiper-button-prev"></div>
                    <div class="swiper-pagination swiper-pagination-progressbar swiper-pagination-horizontal"></div>
                </div>
            </div>
        </div>
    </section>

    <!-- NEW JOBS -->
    <section class="py-24 bg-white animated-section">
        <div class="container mx-auto px-6">
            <div class="text-center mb-16">
                <h2 class="text-3xl md:text-4xl font-bold mb-3" data-translate-key="new_jobs_title">××©×¨×•×ª ×—×“×©×•×ª âœ¨</h2>
                <p class="text-lg text-gray-600" data-translate-key="new_jobs_subtitle">×”×”×–×“×× ×•×™×•×ª ×”××—×¨×•× ×•×ª ×©×”×¦×˜×¨×¤×•.</p>
            </div>

            <div class="relative story-slider-container" id="new-jobs-container">
                <div class="swiper new-jobs-slider">
                    <div class="swiper-wrapper"></div>
                    <div class="swiper-button-next"></div>
                    <div class="swiper-button-prev"></div>
                    <div class="swiper-pagination swiper-pagination-progressbar swiper-pagination-horizontal"></div>
                </div>
            </div>
        </div>
    </section>

    <!-- SEND CV CTA -->
    <section id="send-cv-section" class="py-24 bg-teal-50 animated-section">
        <div class="container mx-auto px-6 text-center">
            <div class="max-w-3xl mx-auto">
                <i class="fas fa-file-signature text-6xl text-teal-500 mb-6"></i>
                <h2 class="text-3xl md:text-4xl font-bold mb-4" data-translate-key="cta_title">×œ× ××¦××ª× ××ª ××” ×©×—×™×¤×©×ª×?</h2>
                <p class="text-lg text-gray-600 mb-8" data-translate-key="cta_subtitle">×©×œ×—×• ×œ× ×• ××ª ×§×•×¨×•×ª ×”×—×™×™× ×•×”×¦×•×•×ª ×”××§×¦×•×¢×™ ×©×œ× ×• ×™××¦× ×¢×‘×•×¨×›× ××ª ×”×”×–×“×× ×•×ª ×”×‘××”.</p>
                <button id="open-cv-modal-button" class="bg-teal-500 text-white font-bold px-10 py-4 rounded-full hover:bg-teal-600 transition-all duration-300 shadow-lg hover:shadow-xl transform hover:scale-105 text-xl">
                    <i class="fas fa-paper-plane mr-3"></i>
                    <span data-translate-key="cta_button">×©×œ×™×—×ª ×§×•×¨×•×ª ×—×™×™×</span>
                </button>
            </div>
        </div>
    </section>

    <!-- SOCIAL -->
    <section class="py-24 bg-white animated-section">
        <div class="container mx-auto px-6 text-center">
            <div class="max-w-4xl mx-auto">
                <h2 class="text-3xl md:text-4xl font-bold mb-3" data-translate-key="social_title">×‘×•××• × ×›×™×¨</h2>
                <p class="text-lg text-gray-600 mb-10" data-translate-key="social_subtitle">×× ×—× ×• ×œ× ×¨×§ ××—×¤×©×™× ×œ×›× ×¢×‘×•×“×”, ×× ×—× ×• ×‘×•× ×™× ×™×—×“ ××™×ª×›× ××ª ×”×§×¨×™×™×¨×” ×©×œ×›×. ×¢×§×‘×• ××—×¨×™× ×• ×‘×¨×©×ª×•×ª ×”×—×‘×¨×ª×™×•×ª ×›×“×™ ×œ×§×‘×œ ×˜×™×¤×™×, ×¢×“×›×•× ×™× ×¢×œ ××©×¨×•×ª ×—××•×ª ×•×”×¦×¦×” ×œ×—×™×™× ×‘××©×¨×“.</p>

                <div class="flex flex-col md:flex-row justify-center gap-6">
                    <a href="https://www.facebook.com/profile.php?id=61577628773715&mibextid=rS40aB7S9Ucbxw6v" target="_blank" rel="noopener noreferrer" class="flex items-center justify-center gap-4 bg-blue-600 text-white font-bold px-8 py-4 rounded-lg hover:bg-blue-700 transition-all duration-300 shadow-lg hover:shadow-xl transform hover:scale-105 text-xl w-full md:w-auto">
                        <i class="fab fa-facebook text-2xl"></i>
                        <span data-translate-key="social_follow_facebook">×¢×§×‘×• ××—×¨×™× ×• ×‘×¤×™×™×¡×‘×•×§</span>
                    </a>
                    <a href="https://www.tiktok.com/@calanit_hr?_t=ZS-8xDrw4nwyck&_r=1" target="_blank" rel="noopener noreferrer" class="flex items-center justify-center gap-4 bg-gray-800 text-white font-bold px-8 py-4 rounded-lg hover:bg-gray-900 transition-all duration-300 shadow-lg hover:shadow-xl transform hover:scale-105 text-xl w-full md:w-auto">
                        <i class="fab fa-tiktok text-2xl"></i>
                        <span data-translate-key="social_follow_tiktok">×¢×§×‘×• ××—×¨×™× ×• ×‘×˜×™×§×˜×•×§</span>
                    </a>
                    <a href="https://www.instagram.com/calanit_hr?igsh=eXQ0ZWVqZjUydXVu&utm_source=qr" target="_blank" rel="noopener noreferrer" class="flex items-center justify-center gap-4 bg-pink-600 text-white font-bold px-8 py-4 rounded-lg hover:bg-pink-700 transition-all duration-300 shadow-lg hover:shadow-xl transform hover:scale-105 text-xl w-full md:w-auto">
                        <i class="fab fa-instagram text-2xl"></i>
                        <span data-translate-key="social_follow_instagram">×¢×§×‘×• ××—×¨×™× ×• ×‘××™× ×¡×˜×’×¨×</span>
                    </a>
                </div>
            </div>
        </div>
    </section>
</main>

<!-- CV MODAL -->
<div id="cv-modal" class="modal fixed inset-0 bg-black bg-opacity-70 flex items-center justify-center p-4 hidden opacity-0 z-50" aria-hidden="true">
    <div class="modal-content bg-white w-full max-w-lg rounded-2xl shadow-2xl p-6 md:p-8 transform scale-95 opacity-0 relative">
        <div class="flex justify-between items-center mb-6">
            <h3 id="cv-modal-title" class="text-2xl font-bold text-gray-800" data-translate-key="cv_modal_title">×©×œ×™×—×ª ×§×•×¨×•×ª ×—×™×™×</h3>
            <div id="cv-step-indicator" class="text-sm font-semibold text-gray-500">×©×œ×‘ 1 ××ª×•×š 2</div>
        </div>
        <button id="close-cv-modal" class="absolute top-4 left-4 text-gray-400 hover:text-gray-700 text-2xl w-10 h-10 flex items-center justify-center rounded-full hover:bg-gray-100 transition-all" aria-label="×¡×’×•×¨">Ã—</button>

        <form id="cv-form" novalidate>
            <!-- STEP 1 -->
            <div id="cv-step-1" class="space-y-5">
                <div class="grid grid-cols-1 md:grid-cols-2 gap-5">
                    <div>
                        <label for="firstName" class="font-medium text-sm text-gray-700" data-translate-key="form_first_name">×©× ×¤×¨×˜×™ <span class="text-red-500">*</span></label>
                        <input type="text" id="firstName" required class="mt-1 w-full border-gray-300 rounded-lg shadow-sm px-4 py-2 focus:ring-teal-500 focus:border-teal-500 transition">
                        <p id="firstName-error" class="text-red-500 text-xs h-4 mt-1"></p>
                    </div>
                    <div>
                        <label for="lastName" class="font-medium text-sm text-gray-700" data-translate-key="form_last_name">×©× ××©×¤×—×” <span class="text-red-500">*</span></label>
                        <input type="text" id="lastName" required class="mt-1 w-full border-gray-300 rounded-lg shadow-sm px-4 py-2 focus:ring-teal-500 focus:border-teal-500 transition">
                        <p id="lastName-error" class="text-red-500 text-xs h-4 mt-1"></p>
                    </div>
                </div>
                <div>
                    <label for="phone" class="font-medium text-sm text-gray-700" data-translate-key="form_phone">×˜×œ×¤×•×Ÿ <span class="text-red-500">*</span></label>
                    <input type="tel" id="phone" required pattern="^05\d{8}$" placeholder="05XXXXXXXX" class="mt-1 w-full border-gray-300 rounded-lg shadow-sm px-4 py-2 focus:ring-teal-500 focus:border-teal-500 transition" inputmode="tel">
                    <p id="phone-error" class="text-red-500 text-xs h-4 mt-1"></p>
                </div>
            </div>

            <!-- STEP 2 -->
            <div id="cv-step-2" class="space-y-5 hidden">
                <div>
                    <label for="cvFile" class="font-medium text-sm block text-gray-700" data-translate-key="form_cv_file">×§×•×‘×¥ ×§×•×¨×•×ª ×—×™×™× <span class="text-red-500">*</span></label>
                    <input type="file" id="cvFile" required accept=".pdf,.doc,.docx,application/pdf,application/msword,application/vnd.openxmlformats-officedocument.wordprocessingml.document" class="mt-2 block w-full text-sm text-gray-500 file:mr-4 file:py-2 file:px-4 file:rounded-full file:border-0 file:text-sm file:font-semibold file:bg-teal-50 file:text-teal-700 hover:file:bg-teal-100 transition">
                    <p class="text-xs text-gray-500 mt-1" data-translate-key="form_supported_files">×§×‘×¦×™× × ×ª××›×™×: PDF, DOC, DOCX. ×’×•×“×œ ×§×•×‘×¥ ×¢×“ 5MB.</p>
                    <p id="cvFile-error" class="text-red-500 text-xs h-4 mt-1"></p>
                </div>
            </div>

            <div id="cv-form-message" class="text-center text-sm font-medium mt-3 h-5"></div>

            <div class="flex justify-between items-center pt-4">
                <button type="button" id="cv-back-btn" class="bg-gray-200 text-gray-800 font-bold py-2 px-5 rounded-lg hover:bg-gray-300 transition hidden">×—×–×•×¨</button>
                <button type="button" id="cv-next-btn" class="bg-teal-500 text-white font-bold py-2 px-5 rounded-lg hover:bg-teal-600 transition ml-auto">×”×‘×</button>
                <button type="submit" id="cv-submit-button" class="w-full bg-teal-500 text-white py-3 rounded-lg font-bold text-lg hover:bg-teal-600 transition-all duration-300 shadow-md hover:shadow-lg flex items-center justify-center gap-3 hidden">
                    <span data-translate-key="cta_button">×©×œ×™×—×ª ×§×•×¨×•×ª ×—×™×™×</span>
                </button>
            </div>
        </form>
    </div>
</div>

<!-- PARTNERS -->
<section class="partners-section">
    <div class="container mx-auto px-6">
        <h2 class="partners-title" data-translate-key="partners_title">×¢×•×‘×“×™× ×¢× ×”×—×‘×¨×•×ª ×”××•×‘×™×œ×•×ª</h2>
        <div class="partners-marquee-container">
            <div id="partners-marquee-track" class="partners-marquee-track" aria-label="×œ×•×’×•××™× ×©×œ ×©×•×ª×¤×™×"></div>
        </div>
    </div>
</section>

<footer id="footer-placeholder"></footer>

<script src="https://unpkg.com/swiper/swiper-bundle.min.js"></script>
<script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/11.9.1/firebase-app.js";
    import { getFirestore, collection, query as fsQuery, where, getDocs, orderBy, addDoc, serverTimestamp } from "https://www.gstatic.com/firebasejs/11.9.1/firebase-firestore.js";
    import { getStorage, ref, uploadBytes, getDownloadURL } from "https://www.gstatic.com/firebasejs/11.9.1/firebase-storage.js";

    const firebaseConfig = {
        apiKey: "AIzaSyAOKMJabnJ9JGE5CuclCCSjv5Bo3rT49Cw",
        authDomain: "calanit-31a32.firebaseapp.com",
        projectId: "calanit-31a32",
        storageBucket: "calanit-31a32.appspot.com",
        messagingSenderId: "91430351613",
        appId: "1:91430351613:web:ae46b2063f2d4b71428494"
    };
    const app = initializeApp(firebaseConfig);
    const db = getFirestore(app);
    const storage = getStorage(app);

    // ---------- i18n ----------
    const translations = {
        he: { home_page_title: "×›×œ× ×™×ª | ×”×‘×™×ª ×©×œ×š ×œ×§×¨×™×™×¨×”", hero_title: "×”×¦×¢×“ ×”×‘× ×‘×§×¨×™×™×¨×” ×©×œ×š ××ª×—×™×œ ×›××Ÿ", hero_subtitle: "××©×¨×•×ª ×—×“×©×•×ª ××”×—×‘×¨×•×ª ×”××•×‘×™×œ×•×ª ×‘××©×§, ××—×›×•×ª ×¨×§ ×œ×š.", placeholder_keyword: "×œ×“×•×’××: ××¤×ª×— Full-Stack...", placeholder_location: "×”×§×œ×“/×™ ×¢×™×¨...", select_main_category: "×‘×—×¨/×™ ×ª×—×•× ×¨××©×™", select_subcategory: "×‘×—×¨/×™ ×ª×ª ×§×˜×’×•×¨×™×”", search_jobs_button: "×—×™×¤×•×© ××©×¨×•×ª", category_section_title: "×—×™×¤×•×© ×œ×¤×™ ×ª×—×•×", category_section_subtitle: "××¦×/×™ ××ª ×”××©×¨×” ×”×‘××” ×©×œ×š ×‘×§×œ×•×ª.", cat_security: "×‘×™×˜×—×•×Ÿ", cat_drivers: "× ×”×’×™×", cat_manufacturing: "×™×¦×•×¨ ×•×ª×¢×©×™×™×”", cat_cleaning: "× ×™×§×™×•×Ÿ", cat_warehouse: "××—×¡× ×™×", cat_no_experience: "×œ×œ× × ×™×¡×™×•×Ÿ", hot_jobs_title: "××©×¨×•×ª ×—××•×ª ğŸ”¥", hot_jobs_subtitle: "×”×–×“×× ×•×™×•×ª ×©××¡×•×¨ ×œ×›× ×œ×¤×¡×¤×¡.", new_jobs_title: "××©×¨×•×ª ×—×“×©×•×ª âœ¨", new_jobs_subtitle: "×”×”×–×“×× ×•×™×•×ª ×”××—×¨×•× ×•×ª ×©×”×¦×˜×¨×¤×•.", cta_title: "×œ× ××¦××ª× ××ª ××” ×©×—×™×¤×©×ª×?", cta_subtitle: "×©×œ×—×• ×œ× ×• ××ª ×§×•×¨×•×ª ×”×—×™×™× ×•×”×¦×•×•×ª ×”××§×¦×•×¢×™ ×©×œ× ×• ×™××¦× ×¢×‘×•×¨×›× ××ª ×”×”×–×“×× ×•×ª ×”×‘××”.", cta_button: "×©×œ×™×—×ª ×§×•×¨×•×ª ×—×™×™×", no_hot_jobs: "××™×Ÿ ×›×¨×’×¢ ××©×¨×•×ª ×—××•×ª", no_new_jobs: "××™×Ÿ ××©×¨×•×ª ××”×©×‘×•×¢ ×”××—×¨×•×Ÿ", details_button: "×¤×¨×˜×™× × ×•×¡×¤×™×", cv_modal_title: "×©×œ×™×—×ª ×§×•×¨×•×ª ×—×™×™×", form_first_name: "×©× ×¤×¨×˜×™", form_last_name: "×©× ××©×¤×—×”", form_phone: "×˜×œ×¤×•×Ÿ", form_cv_file: "×§×•×‘×¥ ×§×•×¨×•×ª ×—×™×™×", form_supported_files: "×§×‘×¦×™× × ×ª××›×™×: PDF, DOC, DOCX. ×’×•×“×œ ×§×•×‘×¥ ×¢×“ 5MB.", success_message: "×”×¤×¨×˜×™× × ×©×œ×—×• ×‘×”×¦×œ×—×”!", error_message: "××™×¨×¢×” ×©×’×™××” ×‘×©×œ×™×—×”.", sending_message: "×©×•×œ×—...", error_required: "×©×“×” ×—×•×‘×”", error_phone: "××¡×¤×¨ ×˜×œ×¤×•×Ÿ ×œ× ×ª×§×™×Ÿ", error_file_required: "×—×•×‘×” ×œ×”×¢×œ×•×ª ×§×•×‘×¥", error_file_size: "×”×§×•×‘×¥ ×’×“×•×œ ××“×™ (×¢×“ 5MB)", nav_home: "×“×£ ×”×‘×™×ª", nav_all_jobs: "×›×œ ×”××©×¨×•×ª", nav_send_cv: "×©×œ×™×—×ª ×§×•\"×—", nav_contact: "×™×¦×™×¨×ª ×§×©×¨", nav_publish_job: "×¤×¨×¡×•× ×“×¨×™×©×”", nav_publish_job_mobile: "×¤×¨×¡×•× ×“×¨×™×©×ª ×¢×•×‘×“×™×", social_title: "×‘×•××• × ×›×™×¨", social_subtitle: "×× ×—× ×• ×œ× ×¨×§ ××—×¤×©×™× ×œ×›× ×¢×‘×•×“×”, ×× ×—× ×• ×‘×•× ×™× ×™×—×“ ××™×ª×›× ××ª ×”×§×¨×™×™×¨×” ×©×œ×›×. ×¢×§×‘×• ××—×¨×™× ×• ×‘×¨×©×ª×•×ª ×”×—×‘×¨×ª×™×•×ª ×›×“×™ ×œ×§×‘×œ ×˜×™×¤×™×, ×¢×“×›×•× ×™× ×¢×œ ××©×¨×•×ª ×—××•×ª ×•×”×¦×¦×” ×œ×—×™×™× ×‘××©×¨×“.", social_follow_facebook: "×¢×§×‘×• ××—×¨×™× ×• ×‘×¤×™×™×¡×‘×•×§", social_follow_tiktok: "×¢×§×‘×• ××—×¨×™× ×• ×‘×˜×™×§×˜×•×§", social_follow_instagram: "×¢×§×‘×• ××—×¨×™× ×• ×‘××™× ×¡×˜×’×¨×", partners_title: "×¢×•×‘×“×™× ×¢× ×”×—×‘×¨×•×ª ×”××•×‘×™×œ×•×ª", footer_about: "××—×‘×¨×™× ×‘×™×Ÿ ×× ×©×™× ×œ×”×–×“×× ×•×™×•×ª.", footer_nav_quick: "× ×™×•×•×˜ ××”×™×¨", footer_nav_all_jobs: "×›×œ ×”××©×¨×•×ª", footer_nav_send_cv: "×©×œ×™×—×ª ×§×•×¨×•×ª ×—×™×™×", footer_nav_publish_job: "×¤×¨×¡×•× ×“×¨×™×©×”", footer_nav_contact: "×¦×•×¨ ×§×©×¨", footer_nav_legal: "××™×“×¢ ×•××©×¤×˜×™", footer_nav_privacy: "××“×™× ×™×•×ª ×¤×¨×˜×™×•×ª", footer_nav_terms: "×ª× ××™ ×©×™××•×©", footer_nav_talk: "×“×‘×¨×• ××™×ª× ×•", footer_copyright: "Â© ×›×œ ×”×–×›×™×•×ª ×©××•×¨×•×ª ×“×•×¨×•×Ÿ AI ××ª×¨×™× 2025      " },
        ar: { home_page_title: "ÙƒÙ„Ø§Ù†ÙŠØª | Ø¨ÙŠØªÙƒ Ù„Ù„Ù…Ø³ØªÙ‚Ø¨Ù„ Ø§Ù„Ù…Ù‡Ù†ÙŠ", hero_title: "Ø®Ø·ÙˆØªÙƒ Ø§Ù„ØªØ§Ù„ÙŠØ© ÙÙŠ Ø­ÙŠØ§ØªÙƒ Ø§Ù„Ù…Ù‡Ù†ÙŠØ© ØªØ¨Ø¯Ø£ Ù‡Ù†Ø§", hero_subtitle: "ÙˆØ¸Ø§Ø¦Ù Ø¬Ø¯ÙŠØ¯Ø© Ù…Ù† Ø§Ù„Ø´Ø±ÙƒØ§Øª Ø§Ù„Ø±Ø§Ø¦Ø¯Ø© ÙÙŠ Ø§Ù„Ø³ÙˆÙ‚ØŒ ÙÙŠ Ø§Ù†ØªØ¸Ø§Ø±Ùƒ.", placeholder_keyword: "Ù…Ø«Ø§Ù„: Ù…Ø·ÙˆØ± Full-Stack...", placeholder_location: "Ø£Ø¯Ø®Ù„ Ù…Ø¯ÙŠÙ†Ø©...", select_main_category: "Ø§Ø®ØªØ± Ù…Ø¬Ø§Ù„ Ø±Ø¦ÙŠØ³ÙŠ", select_subcategory: "Ø§Ø®ØªØ± ØªØ®ØµØµ ÙØ±Ø¹ÙŠ", search_jobs_button: "Ø¨Ø­Ø« Ø¹Ù† ÙˆØ¸Ø§Ø¦Ù", category_section_title: "Ø§Ù„Ø¨Ø­Ø« Ø­Ø³Ø¨ Ø§Ù„Ù…Ø¬Ø§Ù„", category_section_subtitle: "Ø§Ø¨Ø­Ø« Ø¹Ù† ÙˆØ¸ÙŠÙØªÙƒ Ø§Ù„ØªØ§Ù„ÙŠØ© Ø¨Ø³Ù‡ÙˆÙ„Ø©.", cat_security: "Ø£Ù…Ù†", cat_drivers: "Ø³Ø§Ø¦Ù‚ÙˆÙ†", cat_manufacturing: "ØªØµÙ†ÙŠØ¹ ÙˆØµÙ†Ø§Ø¹Ø©", cat_cleaning: "ØªÙ†Ø¸ÙŠÙ", cat_warehouse: "Ù…Ø®Ø§Ø²Ù†", cat_no_experience: "Ø¨Ø¯ÙˆÙ† Ø®Ø¨Ø±Ø©", hot_jobs_title: "ÙˆØ¸Ø§Ø¦Ù Ø³Ø§Ø®Ù†Ø© ğŸ”¥", hot_jobs_subtitle: "ÙØ±Øµ Ù„Ø§ ØªÙÙˆØª.", new_jobs_title: "ÙˆØ¸Ø§Ø¦Ù Ø¬Ø¯ÙŠØ¯Ø© âœ¨", new_jobs_subtitle: "Ø¢Ø®Ø± Ø§Ù„ÙØ±Øµ Ø§Ù„ØªÙŠ Ø§Ù†Ø¶Ù…Øª.", cta_title: "Ù„Ù… ØªØ¬Ø¯ Ù…Ø§ ÙƒÙ†Øª ØªØ¨Ø­Ø« Ø¹Ù†Ù‡ØŸ", cta_subtitle: "Ø£Ø±Ø³Ù„ Ù„Ù†Ø§ Ø³ÙŠØ±ØªÙƒ Ø§Ù„Ø°Ø§ØªÙŠØ© ÙˆØ³ÙŠØ¹Ø«Ø± ÙØ±ÙŠÙ‚Ù†Ø§ Ø§Ù„Ù…Ø­ØªØ±Ù Ø¹Ù„Ù‰ ÙØ±ØµØªÙƒ Ø§Ù„ØªØ§Ù„ÙŠØ©.", cta_button: "Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ø³ÙŠØ±Ø© Ø§Ù„Ø°Ø§ØªÙŠØ©", no_hot_jobs: "Ù„Ø§ ØªÙˆØ¬Ø¯ ÙˆØ¸Ø§Ø¦Ù Ø³Ø§Ø®Ù†Ø© Ø­Ø§Ù„ÙŠÙ‹Ø§", no_new_jobs: "Ù„Ø§ ØªÙˆØ¬Ø¯ ÙˆØ¸Ø§Ø¦Ù Ù…Ù† Ø§Ù„Ø£Ø³Ø¨ÙˆØ¹ Ø§Ù„Ù…Ø§Ø¶ÙŠ", details_button: "Ø§Ù„ØªÙØ§ØµÙŠÙ„", cv_modal_title: "Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ø³ÙŠØ±Ø© Ø§Ù„Ø°Ø§ØªÙŠØ©", form_first_name: "Ø§Ù„Ø§Ø³Ù… Ø§Ù„Ø£ÙˆÙ„", form_last_name: "Ø§Ø³Ù… Ø§Ù„Ø¹Ø§Ø¦Ù„Ø©", form_phone: "Ù‡Ø§ØªÙ", form_cv_file: "Ù…Ù„Ù Ø§Ù„Ø³ÙŠØ±Ø© Ø§Ù„Ø°Ø§ØªÙŠØ©", form_supported_files: "Ø§Ù„Ù…Ù„ÙØ§Øª Ø§Ù„Ù…Ø¯Ø¹ÙˆÙ…Ø©: PDF, DOC, DOCX. Ø­Ø¬Ù… Ø§Ù„Ù…Ù„Ù Ø­ØªÙ‰ 5 Ù…ÙŠØ¬Ø§Ø¨Ø§ÙŠØª.", success_message: "ØªÙ… Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø¨Ù†Ø¬Ø§Ø­!", error_message: "Ø­Ø¯Ø« Ø®Ø·Ø£ Ø£Ø«Ù†Ø§Ø¡ Ø§Ù„Ø¥Ø±Ø³Ø§Ù„.", sending_message: "Ø¬Ø§Ø± Ø§Ù„Ø¥Ø±Ø³Ø§Ù„...", error_required: "Ø­Ù‚Ù„ Ù…Ø·Ù„ÙˆØ¨", error_phone: "Ø±Ù‚Ù… Ø§Ù„Ù‡Ø§ØªÙ ØºÙŠØ± ØµØ§Ù„Ø­", error_file_required: "ÙŠØ¬Ø¨ ØªØ­Ù…ÙŠÙ„ Ù…Ù„Ù", error_file_size: "Ø§Ù„Ù…Ù„Ù ÙƒØ¨ÙŠØ± Ø¬Ø¯Ù‹Ø§ (Ø­ØªÙ‰ 5 Ù…ÙŠØ¬Ø§Ø¨Ø§ÙŠØª)", nav_home: "Ø§Ù„ØµÙØ­Ø© Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©", nav_all_jobs: "ÙƒÙ„ Ø§Ù„ÙˆØ¸Ø§Ø¦Ù", nav_send_cv: "Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ø³ÙŠØ±Ø© Ø§Ù„Ø°Ø§ØªÙŠØ©", nav_contact: "Ø§ØªØµÙ„ Ø¨Ù†Ø§", nav_publish_job: "Ù†Ø´Ø± Ø·Ù„Ø¨", nav_publish_job_mobile: "Ù†Ø´Ø± Ø·Ù„Ø¨ Ù…ÙˆØ¸ÙÙŠÙ†", social_title: "Ø¯Ø¹ÙˆÙ†Ø§ Ù†ØªØ¹Ø±Ù", social_subtitle: "Ù†Ø­Ù† Ù„Ø§ Ù†Ø¨Ø­Ø« Ù„Ùƒ Ø¹Ù† ÙˆØ¸ÙŠÙØ© ÙØ­Ø³Ø¨ØŒ Ø¨Ù„ Ù†Ø¨Ù†ÙŠ Ù…Ø¹Ùƒ Ù…Ø³ÙŠØ±ØªÙƒ Ø§Ù„Ù…Ù‡Ù†ÙŠØ©. ØªØ§Ø¨Ø¹Ù†Ø§ Ø¹Ù„Ù‰ Ø§Ù„Ø´Ø¨ÙƒØ§Øª Ø§Ù„Ø§Ø¬ØªÙ…Ø§Ø¹ÙŠØ© Ù„Ù„Ø­ØµÙˆÙ„ Ø¹Ù„Ù‰ Ù†ØµØ§Ø¦Ø­ ÙˆØªØ­Ø¯ÙŠØ«Ø§Øª Ø­ÙˆÙ„ Ø§Ù„ÙˆØ¸Ø§Ø¦Ù Ø§Ù„Ø³Ø§Ø®Ù†Ø© ÙˆÙ†Ø¸Ø±Ø© Ø¹Ù„Ù‰ Ø§Ù„Ø­ÙŠØ§Ø© ÙÙŠ Ø§Ù„Ù…ÙƒØªØ¨.", social_follow_facebook: "ØªØ§Ø¨Ø¹ÙˆÙ†Ø§ Ø¹Ù„Ù‰ ÙÙŠØ³Ø¨ÙˆÙƒ", social_follow_tiktok: "ØªØ§Ø¨Ø¹ÙˆÙ†Ø§ Ø¹Ù„Ù‰ ØªÙŠÙƒ ØªÙˆÙƒ", social_follow_instagram: "ØªØ§Ø¨Ø¹ÙˆÙ†Ø§ Ø¹Ù„Ù‰ Ø¥Ù†Ø³ØªØºØ±Ø§Ù…", partners_title: "Ù†Ø¹Ù…Ù„ Ù…Ø¹ Ø§Ù„Ø´Ø±ÙƒØ§Øª Ø§Ù„Ø±Ø§Ø¦Ø¯Ø©", footer_about: "Ù†Ø±Ø¨Ø· Ø§Ù„Ù†Ø§Ø³ Ø¨Ø§Ù„ÙØ±Øµ.", footer_nav_quick: "Ø±ÙˆØ§Ø¨Ø· Ø³Ø±ÙŠØ¹Ø©", footer_nav_all_jobs: "ÙƒÙ„ Ø§Ù„ÙˆØ¸Ø§Ø¦Ù", footer_nav_send_cv: "Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ø³ÙŠØ±Ø© Ø§Ù„Ø°Ø§ØªÙŠØ©", footer_nav_publish_job: "Ù†Ø´Ø± Ø·Ù„Ø¨", footer_nav_contact: "Ø§ØªØµÙ„ Ø¨Ù†Ø§", footer_nav_legal: "Ù…Ø¹Ù„ÙˆÙ…Ø§Øª ÙˆÙ‚Ø§Ù†ÙˆÙ†ÙŠØ©", footer_nav_privacy: "Ø³ÙŠØ§Ø³Ø© Ø§Ù„Ø®ØµÙˆØµÙŠØ©", footer_nav_terms: "Ø´Ø±ÙˆØ· Ø§Ù„Ø§Ø³ØªØ®Ø¯Ø§Ù…", footer_nav_talk: "ØªØ­Ø¯Ø« Ù…Ø¹Ù†Ø§", footer_copyright: "Â© 2024 ÙƒÙ„Ø§Ù†ÙŠØª. Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø­Ù‚ÙˆÙ‚ Ù…Ø­ÙÙˆØ¸Ø©." }
    };

    function setLanguage(lang) {
        localStorage.setItem('calanit_lang', lang);
        document.documentElement.lang = lang;

        document.querySelectorAll('[data-translate-key]').forEach(el => {
            const key = el.dataset.translateKey;
            if (translations[lang] && translations[lang][key]) {
                const value = translations[lang][key];
                if (typeof el.placeholder !== "undefined" && el.placeholder !== null) {
                    el.placeholder = value;
                } else {
                    el.innerHTML = value;
                }
            }
        });

        document.querySelectorAll('.lang-btn-menu').forEach(btn =>
            btn.classList.toggle('active', btn.id.includes(`-${lang}-`))
        );

        // ×¨×¢× ×•×Ÿ ×¡×œ×™×™×“×¨×™× ×œ×¤×™ ×©×¤×” × ×•×›×—×™×ª
        createStorySlider({
            containerId: '#hot-jobs-container',
            fsQuery: fsQuery(collection(db, "jobs"), where("isHot", "==", true)),
            noJobsKey: 'no_hot_jobs',
            jobIconClass: 'fas fa-fire text-amber-400'
        });

        createStorySlider({
            containerId: '#new-jobs-container',
            fsQuery: fsQuery(
                collection(db, "jobs"),
                where("createdAt", ">=", new Date(Date.now() - 7 * 24 * 60 * 60 * 1000)),
                orderBy("createdAt", "desc")
            ),
            noJobsKey: 'no_new_jobs',
            jobIconClass: 'fas fa-sparkles text-sky-300'
        });
    }

    // ---------- Helpers ----------
    let allCities = [], jobTypesData = {}, selectedLocations = new Set(), selectedCategories = new Set();
    async function loadJsonData(filePath, fallback) {
        try { const res = await fetch(filePath, { cache: "no-cache" }); return res.ok ? res.json() : fallback; }
        catch { return fallback; }
    }
    function loadComponent(url, id, cb) {
        fetch(url).then(res => res.ok ? res.text() : Promise.reject(url))
            .then(html => { document.getElementById(id).innerHTML = html; cb && cb(); })
            .catch(() => console.error(`Failed loading ${url}`));
    }

    // ---------- Filter bubbles & autocomplete ----------
    function normalizeStr(s) {
        return (s || "")
            .toLowerCase()
            .replace(/[\u05C1\u05C2\u05BC\u05B0-\u05BD\u05BF]/g, ""); // ××¡×™×¨ × ×™×§×•×“/×“×™××§×¨×™×˜×™×•×ª ×¢×‘×¨×™×ª
    }
    function setupFilterBubbles(config) {
        const { input, resultsContainer, bubblesContainer, dataSet, selectedSet } = config;

        const renderBubbles = () => {
            bubblesContainer.innerHTML = '';
            const bubbleColorClass = config.colorClass || 'bubble-location';
            selectedSet.forEach(item => {
                const bubble = document.createElement('div');
                bubble.className = `text-sm font-semibold px-3 py-1.5 rounded-full flex items-center gap-2 ${bubbleColorClass}`;
                bubble.innerHTML = `<span>${item}</span><button type="button" class="font-sans text-sm opacity-75 hover:opacity-100" aria-label="×”×¡×¨">Ã—</button>`;
                bubble.querySelector('button').addEventListener('click', () => { selectedSet.delete(item); renderBubbles(); });
                bubblesContainer.appendChild(bubble);
            });
        };

        const addItem = (item) => {
            if (item && !selectedSet.has(item)) { selectedSet.add(item); renderBubbles(); }
            input.value = ''; resultsContainer.classList.add('hidden');
        };

        input.addEventListener('input', () => {
            const q = normalizeStr(input.value.trim());
            if (q.length < 2) { resultsContainer.classList.add('hidden'); return; }
            const filtered = dataSet
                .filter(c => normalizeStr(c).startsWith(q) && !selectedSet.has(c))
                .slice(0, 7);

            resultsContainer.innerHTML = '';
            if (filtered.length) {
                filtered.forEach(txt => {
                    const item = document.createElement('div');
                    item.className = 'p-3 text-gray-800 cursor-pointer autocomplete-item';
                    item.textContent = txt;
                    item.addEventListener('click', () => addItem(txt));
                    resultsContainer.appendChild(item);
                });
                resultsContainer.classList.remove('hidden');
            } else {
                resultsContainer.classList.add('hidden');
            }
        });

        // ×”×•×¡×¤×” ×¢× ×× ×˜×¨: ×ª×•×¦××ª ×”××•×˜×•×§×•××¤×œ×™×˜ ×”×¨××©×•× ×”, ×•×× ××™×Ÿ â€“ ×”×¢×¨×š ×”××“×•×™×§ ×× ×§×™×™× ×‘×“××˜×”
        input.addEventListener('keydown', (e) => {
            if (e.key === 'Enter') {
                e.preventDefault();
                const items = Array.from(resultsContainer.children);
                if (items.length) { addItem(items[0].textContent); return; }
                const exact = dataSet.find(c => normalizeStr(c) === normalizeStr(input.value.trim()));
                if (exact) addItem(exact);
            }
        });

        document.addEventListener('click', e => {
            if (!input.parentElement.contains(e.target)) resultsContainer.classList.add('hidden');
        });

        bubblesContainer.addEventListener('render', renderBubbles);
    }

    function setupCategoryFilter() {
        const mainSelect = document.getElementById('main-category-select');
        const subSelect = document.getElementById('subcategory-select');
        const categoriesContainer = document.getElementById('selected-categories-container');
        const lang = localStorage.getItem('calanit_lang') || 'he';

        mainSelect.innerHTML = `<option value="">${translations[lang].select_main_category}</option>`;
        Object.keys(jobTypesData).sort().forEach(cat => mainSelect.add(new Option(cat, cat)));

        mainSelect.addEventListener('change', () => {
            const selectedMain = mainSelect.value;
            subSelect.innerHTML = `<option value="">${translations[lang].select_subcategory}</option>`;
            if (selectedMain && jobTypesData[selectedMain]) {
                jobTypesData[selectedMain].forEach(sub => subSelect.add(new Option(sub, sub)));
                subSelect.disabled = false;
            } else {
                subSelect.disabled = true;
            }
        });

        subSelect.addEventListener('change', () => {
            if (subSelect.value) {
                selectedCategories.add(subSelect.value);
                categoriesContainer.dispatchEvent(new Event('render'));
                subSelect.value = "";
            }
        });

        categoriesContainer.addEventListener('render', () => {
            categoriesContainer.innerHTML = '';
            selectedCategories.forEach(item => {
                const bubble = document.createElement('div');
                bubble.className = `bubble-category text-sm font-semibold px-3 py-1.5 rounded-full flex items-center gap-2`;
                bubble.innerHTML = `<span>${item}</span><button type="button" class="font-sans text-sm opacity-75 hover:opacity-100" aria-label="×”×¡×¨">Ã—</button>`;
                bubble.querySelector('button').addEventListener('click', () => {
                    selectedCategories.delete(item);
                    categoriesContainer.dispatchEvent(new Event('render'));
                });
                categoriesContainer.appendChild(bubble);
            });
        });
    }

    // ---------- Swiper (with instance management) ----------
    window._swipers = window._swipers || {};
    async function createStorySlider(config) {
        const containerSelector = `${config.containerId} .swiper`;
        const wrapper = document.querySelector(`${config.containerId} .swiper-wrapper`);
        if (!wrapper) return;

        // Destroy previous instance if exists
        if (window._swipers[containerSelector]) {
            try { window._swipers[containerSelector].destroy(true, true); } catch {}
            window._swipers[containerSelector] = null;
        }

        wrapper.innerHTML = `
            <div class="swiper-slide bg-gray-200">
                <div class="story-content text-center text-gray-600 w-full flex items-center justify-center">
                    <i class="fas fa-spinner fa-spin text-4xl"></i>
                </div>
            </div>`;

        try {
            const snapshot = await getDocs(config.fsQuery);
            const lang = localStorage.getItem('calanit_lang') || 'he';

            if (snapshot.empty) {
                wrapper.innerHTML = `
                    <div class="swiper-slide bg-gray-200">
                        <div class="story-overlay"></div>
                        <div class="story-content">
                            <h3 class="text-3xl font-bold">${translations[lang][config.noJobsKey]}</h3>
                        </div>
                    </div>`;
            } else {
                wrapper.innerHTML = '';
                snapshot.forEach(doc => {
                    const job = doc.data(), jobId = doc.id;
                    const imageUrl = job.imageUrl || `https://placehold.co/800x500/14b8a6/ffffff?text=${encodeURIComponent(job.title || '')}`;
                    const slide = document.createElement('div');
                    slide.className = 'swiper-slide';
                    slide.style.backgroundImage = `url('${imageUrl}')`;
                    slide.innerHTML = `
                        <div class="story-overlay"></div>
                        <div class="story-content w-full">
                            <h3 class="text-3xl md:text-4xl font-black drop-shadow-lg flex items-center gap-3">
                                <i class="${config.jobIconClass}"></i> ${job.title || ''}
                            </h3>
                            <div class="text-lg font-medium mt-2 mb-6 opacity-90">
                                <i class="fas fa-map-marker-alt ml-1"></i> ${Array.isArray(job.locations) ? job.locations.join(', ') : (job.locations || '')}
                            </div>
                            <a href="job-details.html?id=${jobId}" class="bg-white text-teal-600 px-8 py-3 rounded-full font-bold shadow-lg hover:bg-teal-50 transition text-lg mt-4 inline-block">
                                ${translations[lang]['details_button']}
                            </a>
                        </div>`;
                    wrapper.appendChild(slide);
                });
            }

            window._swipers[containerSelector] = new Swiper(containerSelector, {
                slidesPerView: 1,
                effect: 'fade',
                fadeEffect: { crossFade: true },
                loop: wrapper.children.length > 1,
                autoplay: wrapper.children.length > 1 ? { delay: 7000 } : false,
                pagination: { el: `${config.containerId} .swiper-pagination`, type: 'progressbar' },
                navigation: { nextEl: `${config.containerId} .swiper-button-next`, prevEl: `${config.containerId} .swiper-button-prev` }
            });
        } catch (err) {
            console.error(`Error loading jobs for ${config.containerId}:`, err);
            wrapper.innerHTML = `
                <div class="swiper-slide bg-gray-200">
                    <div class="story-content text-center text-red-600 w-full">×©×’×™××” ×‘×˜×¢×™× ×ª × ×ª×•× ×™ ××©×¨×•×ª</div>
                </div>`;
        }
    }

    // ---------- CV modal ----------
    function setupCVModal() {
        const modal = document.getElementById('cv-modal');
        const form = document.getElementById('cv-form');
        const openBtn = document.getElementById('open-cv-modal-button');
        const closeBtn = document.getElementById('close-cv-modal');

        const step1 = document.getElementById('cv-step-1');
        const step2 = document.getElementById('cv-step-2');
        const stepIndicator = document.getElementById('cv-step-indicator');
        const nextBtn = document.getElementById('cv-next-btn');
        const backBtn = document.getElementById('cv-back-btn');
        const submitBtn = document.getElementById('cv-submit-button');

        let currentCVStep = 1;

        const updateView = () => {
            stepIndicator.textContent = `×©×œ×‘ ${currentCVStep} ××ª×•×š 2`;
            if (currentCVStep === 1) {
                step1.classList.remove('hidden');
                step2.classList.add('hidden');
                nextBtn.classList.remove('hidden');
                backBtn.classList.add('hidden');
                submitBtn.classList.add('hidden');
            } else {
                step1.classList.add('hidden');
                step2.classList.remove('hidden');
                nextBtn.classList.add('hidden');
                backBtn.classList.remove('hidden');
                submitBtn.classList.remove('hidden');
            }
        };

        const validateStep1 = () => {
            const lang = localStorage.getItem('calanit_lang') || 'he';
            let isValid = true;

            ['firstName', 'lastName', 'phone'].forEach(id => {
                document.getElementById(id).classList.remove('input-error');
                document.getElementById(`${id}-error`).textContent = '';
            });

            const firstName = document.getElementById('firstName');
            if (!firstName.value.trim()) {
                firstName.classList.add('input-error');
                document.getElementById('firstName-error').textContent = translations[lang].error_required;
                isValid = false;
            }

            const lastName = document.getElementById('lastName');
            if (!lastName.value.trim()) {
                lastName.classList.add('input-error');
                document.getElementById('lastName-error').textContent = translations[lang].error_required;
                isValid = false;
            }

            const phone = document.getElementById('phone');
            if (!/^05\d{8}$/.test(phone.value.trim())) {
                phone.classList.add('input-error');
                document.getElementById('phone-error').textContent = translations[lang].error_phone;
                isValid = false;
            }
            return isValid;
        };

        const validateStep2 = () => {
            const lang = localStorage.getItem('calanit_lang') || 'he';
            const input = document.getElementById('cvFile');
            const file = input.files[0];
            const errEl = document.getElementById('cvFile-error');
            errEl.textContent = '';
            input.classList.remove('input-error');

            if (!file) {
                errEl.textContent = translations[lang].error_file_required;
                input.classList.add('input-error');
                return false;
            }
            if (file.size > 5 * 1024 * 1024) {
                errEl.textContent = translations[lang].error_file_size;
                input.classList.add('input-error');
                return false;
            }
            const allowedExt = ['pdf','doc','docx'];
            const ext = (file.name.split('.').pop() || '').toLowerCase();
            const allowedMime = [
                'application/pdf',
                'application/msword',
                'application/vnd.openxmlformats-officedocument.wordprocessingml.document'
            ];
            if (!allowedExt.includes(ext) || (file.type && !allowedMime.includes(file.type))) {
                errEl.textContent = '×¡×•×’ ×§×•×‘×¥ ×œ× × ×ª××š';
                input.classList.add('input-error');
                return false;
            }
            return true;
        };

        nextBtn.addEventListener('click', () => { if (validateStep1()) { currentCVStep = 2; updateView(); } });
        backBtn.addEventListener('click', () => { currentCVStep = 1; updateView(); });

        const closeModal = () => {
            if (!modal) return;
            modal.classList.add('opacity-0');
            modal.querySelector('.modal-content').classList.add('scale-95', 'opacity-0');
            setTimeout(() => {
                modal.classList.add('hidden');
                form.reset();
                currentCVStep = 1;
                updateView();
                document.getElementById('cv-form-message').textContent = '';
                ['firstName','lastName','phone','cvFile'].forEach(id => {
                    const el = document.getElementById(id);
                    el && el.classList.remove('input-error');
                    const errEl = document.getElementById(`${id}-error`);
                    if (errEl) errEl.textContent = '';
                });
                submitBtn.disabled = false;
                submitBtn.innerHTML = `<span>${(translations[localStorage.getItem('calanit_lang') || 'he'].cta_button)}</span>`;
            }, 300);
        };

        window.openCVModal = (jobId, jobTitle) => {
            window.currentJobIdForModal = jobId || null;
            window.currentJobTitleForModal = jobTitle || '×”×’×©×” ×›×œ×œ×™×ª';
            const lang = localStorage.getItem('calanit_lang') || 'he';
            modal.querySelector('#cv-modal-title').innerHTML = jobTitle
                ? `${translations[lang]['cv_modal_title']} - ${jobTitle}`
                : translations[lang]['cv_modal_title'];
            modal.classList.remove('hidden');
            setTimeout(() => {
                modal.classList.remove('opacity-0');
                modal.querySelector('.modal-content').classList.remove('scale-95', 'opacity-0');
            }, 10);
            currentCVStep = 1; updateView();
        };

        openBtn.addEventListener('click', () => openCVModal());
        closeBtn.addEventListener('click', closeModal);

        form.addEventListener('submit', async (e) => {
            e.preventDefault();
            if (!validateStep2()) return;

            const msgEl = form.querySelector('#cv-form-message');
            const lang = localStorage.getItem('calanit_lang') || 'he';
            const fileInput = form.querySelector('#cvFile');
            const file = fileInput.files[0];

            submitBtn.disabled = true;
            submitBtn.innerHTML = `<i class="fas fa-spinner fa-spin"></i> <span class="ml-2">${translations[lang].sending_message}</span>`;

            // sanitize filename
            const safeName = (file.name || 'cv')
                .replace(/[^a-zA-Z0-9._-]/g, '_')
                .slice(0, 120);

            const storageRef = ref(storage, `cvs/${Date.now()}_${safeName}`);

            try {
                await uploadBytes(storageRef, file, { contentType: file.type || undefined });
                const fileURL = await getDownloadURL(storageRef);

                await addDoc(collection(db, "jobApplicants"), {
                    firstName: document.getElementById('firstName').value.trim(),
                    lastName: document.getElementById('lastName').value.trim(),
                    phone: document.getElementById('phone').value.trim(),
                    fileURL,
                    originalName: file.name,
                    contentType: file.type || null,
                    jobId: window.currentJobIdForModal || null,
                    jobTitle: window.currentJobTitleForModal || '×”×’×©×” ×›×œ×œ×™×ª',
                    createdAt: serverTimestamp()
                });

                msgEl.className = 'text-green-600 font-semibold';
                msgEl.textContent = translations[lang].success_message;
                setTimeout(closeModal, 1500);
            } catch (err) {
                console.error("Error during CV submission:", err);
                msgEl.className = 'text-red-600 font-semibold';
                msgEl.textContent = translations[lang].error_message;
                submitBtn.disabled = false;
                submitBtn.innerHTML = `<span>${translations[lang].cta_button}</span>`;
            }
        });
    }

    // ---------- Inline search open/close ----------
    function setupInlineSearch() {
        const searchWrapper = document.getElementById('hero-search-wrapper');
        const formContainer = document.getElementById('search-form-container');
        const initialButtons = document.getElementById('initial-buttons');
        const openBtn = document.getElementById('open-search-btn');

        const showSearch = () => { initialButtons.classList.add('hidden'); formContainer.classList.add('active'); };
        const hideSearch = () => { initialButtons.classList.remove('hidden'); formContainer.classList.remove('active'); };

        openBtn.addEventListener('click', (e) => { e.stopPropagation(); showSearch(); });
        document.addEventListener('click', (e) => { if (!searchWrapper.contains(e.target)) hideSearch(); });
    }

    // ---------- Partners ----------
    async function renderPartnersMarquee() {
        const marquee = document.getElementById('partners-marquee-track');
        if (!marquee) return;
        marquee.innerHTML = `<span class="text-gray-500">×˜×•×¢×Ÿ...</span>`;
        try {
            const snapshot = await getDocs(collection(db, "partners"));
            let partners = [];
            snapshot.forEach(doc => { const data = doc.data(); if (data.logoUrl) partners.push({ name: data.name || 'Partner', logoUrl: data.logoUrl }); });
            if (!partners.length) { marquee.innerHTML = `<span class="text-gray-500">×œ× ×”×•×’×“×¨×• ×œ×•×’×•××™× ×©×œ ×—×‘×¨×•×ª.</span>`; return; }
            const triple = [...partners, ...partners, ...partners];
            marquee.innerHTML = '';
            triple.forEach(p => marquee.innerHTML += `
                <div class="partner-logo-wrapper" title="${p.name}">
                    <img class="partner-logo-img" src="${p.logoUrl}" alt="${p.name}" loading="lazy">
                </div>`);
        } catch { marquee.innerHTML = `<span class="text-red-500">×©×’×™××” ×‘×˜×¢×™× ×ª ×”×—×‘×¨×•×ª</span>`; }
    }

    // ---------- Bootstrap ----------
    document.addEventListener('DOMContentLoaded', async () => {
        loadComponent('menu.html', 'header-placeholder', () => {
            document.getElementById('mobile-menu-button')?.addEventListener('click', () => document.getElementById('mobile-menu')?.classList.toggle('hidden'));
            document.querySelectorAll('.lang-btn-menu').forEach(btn => btn.addEventListener('click', () => setLanguage(btn.id.includes('-ar-') ? 'ar' : 'he')));
            setLanguage(localStorage.getItem('calanit_lang') || 'he');
        });
        loadComponent('footer.html', 'footer-placeholder', () => { setLanguage(localStorage.getItem('calanit_lang') || 'he'); });

        [allCities, jobTypesData] = await Promise.all([
            loadJsonData('cities.json', []),
            loadJsonData('jobTypesHierarchical.json', {})
        ]);

        setupFilterBubbles({
            input: document.getElementById('location-search-input'),
            resultsContainer: document.getElementById('autocomplete-results'),
            bubblesContainer: document.getElementById('selected-locations-container'),
            dataSet: allCities,
            selectedSet: selectedLocations,
            colorClass: 'bubble-location'
        });
        setupCategoryFilter();

        document.getElementById('search-button').addEventListener('click', () => {
            const params = new URLSearchParams();
            const keyword = document.getElementById('keyword-search-input').value.trim();
            if (keyword) params.append('keyword', keyword);
            if (selectedLocations.size) params.append('locations', Array.from(selectedLocations).join(','));
            if (selectedCategories.size) params.append('categories', Array.from(selectedCategories).join(','));
            window.location.href = `jobs.html?${params.toString()}`;
        });

        document.querySelectorAll('.animated-section').forEach(el =>
            new IntersectionObserver((entries, obs) => {
                if (entries[0].isIntersecting) { el.classList.add('is-visible'); obs.unobserve(el); }
            }, { threshold: 0.1 }).observe(el)
        );

        setupCVModal();
        setupInlineSearch();
        renderPartnersMarquee();

        // ×¨×¢× ×•×Ÿ ×©×¤×” ×¨××©×•× ×™×ª (×‘×™×˜×—×•×Ÿ ×›×¤×•×œ ××—×¨×™ ×”×˜×¢× ×•×ª ×“×™× ××™×•×ª)
        setLanguage(localStorage.getItem('calanit_lang') || 'he');
    });
</script>
</body>
</html>
