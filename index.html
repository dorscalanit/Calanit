<!DOCTYPE html>
<html lang="he" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>×›×œ× ×™×ª | ×”×‘×™×ª ×©×œ×š ×œ×§×¨×™×™×¨×”</title>
    <!-- Google Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Heebo:wght@400;500;700;900&display=swap" rel="stylesheet">
    <!-- SwiperJS for Sliders -->
    <link rel="stylesheet" href="https://unpkg.com/swiper/swiper-bundle.min.css" />
    <!-- Font Awesome for Icons -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.2/css/all.min.css">
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Custom Styles -->
    <style>
        body { 
            font-family: 'Heebo', sans-serif; 
            scroll-behavior: smooth;
            background-color: #f8fafc;
        }
        .brand-logo { 
            font-weight: 900; 
            font-size: 1.8rem;
        }
        .hero-gradient { 
            background: linear-gradient(135deg, #3b82f6 0%, #1d4ed8 100%); 
        }
        /* --- Story Slider Styles --- */
        .story-slider-container .swiper {
            height: 480px;
            border-radius: 1.5rem;
            box-shadow: 0 10px 25px -5px rgba(0, 0, 0, 0.1), 0 8px 10px -6px rgba(0, 0, 0, 0.1);
            position: relative;
            overflow: hidden;
        }
        .story-slider-container .swiper-slide {
            color: white; display: flex; flex-direction: column; justify-content: flex-end;
            padding: 2rem; background-size: cover; background-position: center;
        }
        .story-slider-container .story-overlay {
            position: absolute; inset: 0;
            background: linear-gradient(to top, rgba(0,0,0,0.8) 0%, rgba(0,0,0,0.4) 40%, rgba(0,0,0,0) 100%);
        }
        .story-slider-container .story-content { position: relative; z-index: 10; }
        .story-slider-container .swiper-pagination-progressbar {
            top: 0 !important; bottom: auto !important; height: 4px !important;
            background: rgba(255, 255, 255, 0.3) !important;
        }
        .story-slider-container .swiper-pagination-progressbar .swiper-pagination-progressbar-fill { background: #fff !important; }
        .story-slider-container .swiper-button-next, 
        .story-slider-container .swiper-button-prev { 
            color: white; background-color: rgba(0, 0, 0, 0.2); 
            width: 50px; height: 50px; border-radius: 50%;
            transition: background-color 0.2s ease;
        }
        .story-slider-container .swiper-button-next:hover, 
        .story-slider-container .swiper-button-prev:hover { background-color: rgba(0, 0, 0, 0.4); }
        .story-slider-container .swiper-button-next::after, 
        .story-slider-container .swiper-button-prev::after { font-size: 20px; font-weight: bold; }

        /* Animation for sections appearing on scroll */
        .animated-section { opacity: 0; transform: translateY(50px); transition: opacity 0.6s ease-out, transform 0.6s ease-out; }
        .animated-section.is-visible { opacity: 1; transform: translateY(0); }
        .modal { transition: opacity 0.3s ease; }
        .modal-content { transition: transform 0.3s ease, opacity 0.3s ease; }

        /* Autocomplete styles */
        .autocomplete-item:hover { background-color: #eef2ff; }
    </style>
</head>
<body class="text-gray-800">

    <!-- Header Placeholder (Loaded via JS) -->
    <header id="header-placeholder" class="bg-white/80 backdrop-blur-md shadow-sm sticky top-0 z-40"></header>

    <main>
        <!-- Hero + Search Section -->
        <section class="hero-gradient text-white">
            <div class="container mx-auto px-6 pt-20 pb-28 text-center">
                <h1 class="text-4xl md:text-6xl font-black mb-4 drop-shadow-md">×”×¦×¢×“ ×”×‘× ×‘×§×¨×™×™×¨×” ×©×œ×š ××ª×—×™×œ ×›××Ÿ</h1>
                <p class="text-lg md:text-xl mb-12 max-w-3xl mx-auto opacity-90">×›×œ× ×™×ª ××—×‘×¨×ª ×‘×™×Ÿ ×”×›×™×©×¨×•×Ÿ ×©×œ×š ×œ××©×¨×•×ª ×”××•×‘×™×œ×•×ª ×‘××©×§. ×‘×•××• × ××¦× ×™×—×“ ××ª ×”×”×–×“×× ×•×ª ×”×‘××” ×©×œ×›×.</p>
                <div class="max-w-4xl mx-auto bg-white/20 backdrop-blur-sm p-4 rounded-xl shadow-2xl">
                    <form id="search-form" class="grid grid-cols-1 md:grid-cols-4 gap-3 items-center">
                        <input type="text" id="keyword-search-input" placeholder="×—×™×¤×•×© ×œ×¤×™ ×ª×¤×§×™×“, ×—×‘×¨×”..." class="md:col-span-2 w-full px-4 py-3 rounded-lg text-gray-800 border-2 border-transparent focus:outline-none focus:ring-4 focus:ring-blue-300 transition-all duration-300" />
                        
                        <!-- Autocomplete Location Input -->
                        <div class="relative">
                            <input type="text" id="location-search-input" placeholder="×”×§×œ×“/×™ ××–×•×¨ ××• ×¢×™×¨..." class="w-full px-4 py-3 rounded-lg text-gray-800 border-2 border-transparent focus:outline-none focus:ring-4 focus:ring-blue-300 transition-all duration-300">
                            <div id="autocomplete-results" class="absolute top-full left-0 right-0 bg-white border border-gray-300 rounded-b-lg shadow-lg z-20 hidden max-h-60 overflow-y-auto text-right"></div>
                        </div>

                        <select id="category-select" class="w-full px-4 py-3 rounded-lg text-gray-500 border-2 border-transparent focus:outline-none focus:ring-4 focus:ring-blue-300 transition-all duration-300">
                            <option value="">×›×œ ×”×ª×—×•××™×</option>
                            <!-- Options can be added here -->
                        </select>
                        <button type="submit" class="md:col-span-4 w-full bg-white text-blue-600 font-bold px-8 py-3 rounded-lg hover:bg-blue-100 transition duration-300 text-lg shadow-md hover:shadow-lg mt-2">
                            <i class="fas fa-search"></i>
                            <span class="ml-2">×—×™×¤×•×© ××©×¨×•×ª</span>
                        </button>
                    </form>
                    <!-- Container for selected location bubbles -->
                    <div id="selected-locations-container" class="flex flex-wrap gap-2 mt-4 px-2 justify-center min-h-[36px]"></div>
                </div>
            </div>
        </section>

        <!-- The rest of the page sections (Hot Jobs, New Jobs, CTA, etc.) -->
        <section class="py-24 animated-section">
            <div class="container mx-auto px-6">
                <div class="text-center mb-16">
                    <h2 class="text-3xl md:text-4xl font-bold mb-3 text-gray-900">××©×¨×•×ª ×—××•×ª ğŸ”¥</h2>
                    <p class="text-lg text-gray-600">×”×–×“×× ×•×™×•×ª ×©××¡×•×¨ ×œ×›× ×œ×¤×¡×¤×¡, ××ª×¢×“×›× ×•×ª ×›×œ ×”×–××Ÿ.</p>
                </div>
                <div class="relative story-slider-container" id="hot-jobs-container">
                    <div class="swiper hot-jobs-slider">
                        <div class="swiper-wrapper"></div>
                        <div class="swiper-button-next"></div>
                        <div class="swiper-button-prev"></div>
                        <div class="swiper-pagination swiper-pagination-progressbar swiper-pagination-horizontal"></div>
                    </div>
                </div>
            </div>
        </section>
        <section class="bg-white py-24 animated-section">
            <div class="container mx-auto px-6">
                <div class="text-center mb-16">
                    <h2 class="text-3xl md:text-4xl font-bold mb-3 text-gray-900">××©×¨×•×ª ×—×“×©×•×ª âœ¨</h2>
                    <p class="text-lg text-gray-600">×”×”×–×“×× ×•×™×•×ª ×”××—×¨×•× ×•×ª ×©×”×¦×˜×¨×¤×• ×œ×××’×¨ ×©×œ× ×•.</p>
                </div>
                <div class="relative story-slider-container" id="new-jobs-container">
                    <div class="swiper new-jobs-slider">
                        <div class="swiper-wrapper"></div>
                        <div class="swiper-button-next"></div>
                        <div class="swiper-button-prev"></div>
                        <div class="swiper-pagination swiper-pagination-progressbar swiper-pagination-horizontal"></div>
                    </div>
                </div>
            </div>
        </section>
        <section id="send-cv-section" class="py-24 animated-section">
            <div class="container mx-auto px-6 text-center">
                <div class="max-w-3xl mx-auto">
                    <i class="fas fa-file-signature text-6xl text-blue-500 mb-6"></i>
                    <h2 class="text-3xl md:text-4xl font-bold text-gray-900 mb-4">×œ× ××¦××ª× ××ª ××” ×©×—×™×¤×©×ª×?</h2>
                    <p class="text-lg text-gray-600 mb-8">××œ ×“××’×”. ×××’×¨ ×”××©×¨×•×ª ×©×œ× ×• ×“×™× ××™ ×•××ª×¢×“×›×Ÿ ×™×•×-×™×•×. ×©×œ×—×• ×œ× ×• ××ª ×§×•×¨×•×ª ×”×—×™×™× ×•×”×¦×•×•×ª ×”××§×¦×•×¢×™ ×©×œ× ×• ×™××¦× ×¢×‘×•×¨×›× ××ª ×”×”×–×“×× ×•×ª ×”×‘××”.</p>
                    <button id="open-cv-modal" class="bg-blue-600 text-white font-bold px-10 py-4 rounded-full hover:bg-blue-700 transition-all duration-300 shadow-lg hover:shadow-xl transform hover:scale-105 text-xl">
                        <i class="fas fa-paper-plane mr-3"></i> ×©×œ×™×—×ª ×§×•×¨×•×ª ×—×™×™×
                    </button>
                </div>
            </div>
        </section>
    </main>

    <!-- CV Submission Modal -->
    <div id="cv-modal" class="modal fixed inset-0 bg-black bg-opacity-70 flex items-center justify-center p-4 hidden opacity-0 z-50">
        <div class="modal-content bg-white w-full max-w-lg rounded-2xl shadow-2xl p-6 md:p-8 transform scale-95 opacity-0 relative">
            <button id="close-cv-modal" class="absolute top-4 left-4 text-gray-400 hover:text-gray-700 text-2xl w-10 h-10 flex items-center justify-center rounded-full hover:bg-gray-100 transition-all">
                <i class="fas fa-times"></i>
            </button>
            <h3 id="cv-modal-title" class="text-2xl font-bold mb-6 text-center text-blue-800">×©×œ×™×—×ª ×§×•×¨×•×ª ×—×™×™×</h3>
            <form id="cv-form" class="space-y-5">
                 <div class="grid grid-cols-1 md:grid-cols-2 gap-5">
                    <div>
                        <label for="firstName" class="font-medium text-sm text-gray-700">×©× ×¤×¨×˜×™ <span class="text-red-500">*</span></label>
                        <input type="text" id="firstName" name="firstName" required class="mt-1 w-full border-gray-300 rounded-lg shadow-sm px-4 py-2 focus:ring-blue-500 focus:border-blue-500 transition">
                    </div>
                    <div>
                        <label for="lastName" class="font-medium text-sm text-gray-700">×©× ××©×¤×—×” <span class="text-red-500">*</span></label>
                        <input type="text" id="lastName" name="lastName" required class="mt-1 w-full border-gray-300 rounded-lg shadow-sm px-4 py-2 focus:ring-blue-500 focus:border-blue-500 transition">
                    </div>
                 </div>
                 <div>
                    <label for="phone" class="font-medium text-sm text-gray-700">×˜×œ×¤×•×Ÿ <span class="text-red-500">*</span></label>
                    <input type="tel" id="phone" name="phone" required pattern="^05\d{8}$" placeholder="05XXXXXXXX" class="mt-1 w-full border-gray-300 rounded-lg shadow-sm px-4 py-2 focus:ring-blue-500 focus:border-blue-500 transition">
                </div>
                <div>
                    <label for="cvFile" class="font-medium text-sm block text-gray-700">×§×•×‘×¥ ×§×•×¨×•×ª ×—×™×™× <span class="text-red-500">*</span></label>
                    <input type="file" id="cvFile" name="cvFile" required accept=".pdf,.doc,.docx" class="mt-2 block w-full text-sm text-gray-500 file:mr-4 file:py-2 file:px-4 file:rounded-full file:border-0 file:text-sm file:font-semibold file:bg-blue-50 file:text-blue-700 hover:file:bg-blue-100 transition">
                    <p class="text-xs text-gray-500 mt-1">×§×‘×¦×™× × ×ª××›×™×: PDF, DOC, DOCX (×¢×“ 5MB)</p>
                </div>
                <button type="submit" id="cv-submit-button" class="w-full bg-blue-600 text-white py-3 rounded-lg font-bold text-lg hover:bg-blue-700 transition-all duration-300 shadow-md hover:shadow-lg flex items-center justify-center gap-3">
                    <span id="submit-text">×©×œ×—/×™ ×§×•×¨×•×ª ×—×™×™×</span>
                    <i id="submit-spinner" class="fas fa-spinner fa-spin hidden"></i>
                </button>
                <div id="cv-form-message" class="text-center text-sm font-medium mt-3 h-5"></div>
            </form>
        </div>
    </div>

    <!-- Footer Placeholder (Loaded via JS) -->
    <footer id="footer-placeholder" class="bg-gray-800 text-white"></footer>

    <!-- Scripts -->
    <script src="https://unpkg.com/swiper/swiper-bundle.min.js"></script>
    <script type="module">
        // Firebase modules
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-app.js";
        import { getFirestore, collection, query, where, getDocs, addDoc, serverTimestamp, orderBy } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-firestore.js";
        import { getStorage, ref, uploadBytes, getDownloadURL } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-storage.js";

        const firebaseConfig = {
            apiKey: "AIzaSyAOKMJabnJ9JGE5CuclCCSjv5Bo3rT49Cw",
            authDomain: "calanit-31a32.firebaseapp.com",
            projectId: "calanit-31a32",
            storageBucket: "calanit-31a32.appspot.com",
            messagingSenderId: "91430351613",
            appId: "1:91430351613:web:ae46b2063f2d4b71428494",
        };

        const app = initializeApp(firebaseConfig);
        const db = getFirestore(app);
        const storage = getStorage(app);

        // --- State Variables ---
        let allCities = [];
        let selectedLocations = new Set();

        // --- Component Loader for Header/Footer ---
        function loadComponent(url, elementId, callback) {
            fetch(url)
                .then(response => { if (!response.ok) throw new Error(`Network error for ${url}`); return response.text(); })
                .then(data => { document.getElementById(elementId).innerHTML = data; if (callback) callback(); })
                .catch(error => console.error(`Error loading component from ${url}:`, error));
        }
        
        // --- City Autocomplete Logic ---
        async function loadCities() {
            try {
                // **FIX:** Reverted to fetching the external cities.json file.
                // This is the correct approach for a production environment.
                const response = await fetch('cities.json');
                if (!response.ok) throw new Error('Could not load cities.json. Make sure it is in the same directory.');
                const citiesData = await response.json();
                allCities = [...new Set(citiesData)].sort((a, b) => a.localeCompare(b, 'he'));
            } catch (error) {
                console.error("Failed to load cities:", error);
                // Provide a fallback list in case the fetch fails
                allCities = ["×ª×œ ××‘×™×‘-×™×¤×•", "×™×¨×•×©×œ×™×", "×—×™×¤×”", "×‘××¨ ×©×‘×¢", "×¨××©×•×Ÿ ×œ×¦×™×•×Ÿ", "×¤×ª×— ×ª×§×•×•×”"]; 
            }
        }

        function setupAutocomplete() {
            const locationInput = document.getElementById('location-search-input');
            const resultsContainer = document.getElementById('autocomplete-results');
            const selectedContainer = document.getElementById('selected-locations-container');

            locationInput.addEventListener('input', () => {
                const query = locationInput.value.trim();
                if (query.length < 2) {
                    resultsContainer.classList.add('hidden');
                    return;
                }
                const filteredCities = allCities
                    .filter(city => city.startsWith(query) && !selectedLocations.has(city))
                    .slice(0, 7); 

                resultsContainer.innerHTML = '';
                if (filteredCities.length > 0) {
                    filteredCities.forEach(city => {
                        const item = document.createElement('div');
                        item.className = 'p-3 text-gray-800 cursor-pointer autocomplete-item';
                        item.textContent = city;
                        item.addEventListener('click', () => selectCity(city));
                        resultsContainer.appendChild(item);
                    });
                    resultsContainer.classList.remove('hidden');
                } else {
                    resultsContainer.classList.add('hidden');
                }
            });
            
            function selectCity(city) {
                if (selectedLocations.has(city)) return;
                selectedLocations.add(city);
                renderSelectedBubbles();
                resultsContainer.classList.add('hidden');
                locationInput.value = '';
                locationInput.focus();
            }

            function removeCity(city) {
                selectedLocations.delete(city);
                renderSelectedBubbles();
            }

            function renderSelectedBubbles() {
                selectedContainer.innerHTML = '';
                selectedLocations.forEach(city => {
                    const bubble = document.createElement('div');
                    bubble.className = 'bg-blue-500 text-white text-sm font-semibold px-3 py-1.5 rounded-full flex items-center gap-2';
                    bubble.innerHTML = `<span>${city}</span><button type="button" class="bg-blue-600 hover:bg-blue-700 rounded-full w-5 h-5 flex items-center justify-center text-xs transition-colors">&times;</button>`;
                    bubble.querySelector('button').addEventListener('click', () => removeCity(city));
                    selectedContainer.appendChild(bubble);
                });
            }

            document.addEventListener('click', (e) => {
                if (!locationInput.contains(e.target) && !resultsContainer.contains(e.target)) {
                    resultsContainer.classList.add('hidden');
                }
            });
        }
        
        // --- Generic Function to Create and Populate a Story Slider ---
        async function createStorySlider(sliderConfig) {
            const { containerId, sliderClass, query, noJobsMessage, jobIconClass } = sliderConfig;
            const swiperWrapper = document.querySelector(`${containerId} .swiper-wrapper`);
            if (!swiperWrapper) return;
            swiperWrapper.innerHTML = `<div class="swiper-slide bg-gray-200"><div class="story-content text-center text-gray-600"><i class="fas fa-spinner fa-spin text-4xl"></i><p class="mt-4 text-lg font-medium">×˜×•×¢×Ÿ ××©×¨×•×ª...</p></div></div>`;
            try {
                const snapshot = await getDocs(query);
                if (snapshot.empty) {
                    swiperWrapper.innerHTML = `<div class="swiper-slide bg-gray-200"><div class="story-overlay"></div><div class="story-content"><h3 class="text-3xl font-bold drop-shadow-md">${noJobsMessage}</h3></div></div>`;
                    return;
                }
                swiperWrapper.innerHTML = '';
                snapshot.forEach(doc => {
                    const job = doc.data();
                    const jobId = doc.id;
                    const imageUrl = job.imageUrl || `https://placehold.co/800x500/3b82f6/ffffff?text=${encodeURIComponent(job.title)}`;
                    const slide = document.createElement('div');
                    slide.className = 'swiper-slide';
                    slide.style.backgroundImage = `url('${imageUrl}')`;
                    slide.innerHTML = `<div class="story-overlay"></div><div class="story-content w-full"><h3 class="text-3xl md:text-4xl font-black drop-shadow-lg flex items-center gap-3"><i class="${jobIconClass}"></i> ${job.title || '×›×•×ª×¨×ª ××©×¨×”'}</h3><div class="text-lg font-medium mt-2 mb-6 opacity-90 drop-shadow-md"><i class="fas fa-map-marker-alt ml-1"></i> ${job.location || '××™×§×•×'}</div><p class="text-base mb-8 line-clamp-3 max-w-xl">${job.description || ''}</p><button class="open-cv-modal-btn bg-white text-blue-600 px-8 py-3 rounded-full font-bold shadow-lg hover:bg-blue-100 transition-all text-lg" data-job-id="${jobId}" data-job-title="${job.title}">×”×’×©×ª ××•×¢××“×•×ª</button></div>`;
                    swiperWrapper.appendChild(slide);
                });
                new Swiper(`${containerId} ${sliderClass}`, { slidesPerView: 1, effect: 'fade', fadeEffect: { crossFade: true }, loop: snapshot.size > 1, autoplay: { delay: 7000, disableOnInteraction: false, pauseOnMouseEnter: true }, pagination: { el: `${containerId} .swiper-pagination`, type: 'progressbar' }, navigation: { nextEl: `${containerId} .swiper-button-next`, prevEl: `${containerId} .swiper-button-prev` }, });
                document.querySelectorAll(`${containerId} .open-cv-modal-btn`).forEach(btn => {
                    btn.addEventListener('click', () => openCVModal(btn.dataset.jobId, btn.dataset.jobTitle));
                });
            } catch (error) {
                console.error(`Error loading jobs for ${containerId}:`, error);
                swiperWrapper.innerHTML = `<div class="swiper-slide bg-red-100 text-red-700 flex items-center justify-center p-8 text-lg text-center">××™×¨×¢×” ×©×’×™××” ×‘×˜×¢×™× ×ª ×”××©×¨×•×ª.</div>`;
            }
        }

        // --- Animations on Scroll ---
        function setupScrollAnimations() {
            const animatedSections = document.querySelectorAll('.animated-section');
            const observer = new IntersectionObserver((entries) => {
                entries.forEach(entry => { if (entry.isIntersecting) { entry.target.classList.add('is-visible'); observer.unobserve(entry.target); } });
            }, { threshold: 0.15 });
            animatedSections.forEach(section => observer.observe(section));
        }
        
        // --- CV Modal Logic ---
        const cvModal = document.getElementById('cv-modal');
        const modalContent = cvModal.querySelector('.modal-content');
        let selectedJobId = null;
        let selectedJobTitle = null;
        function openCVModal(jobId = null, jobTitle = '') {
            selectedJobId = jobId; selectedJobTitle = jobTitle;
            cvModal.classList.remove('hidden'); document.body.style.overflow = 'hidden';
            setTimeout(() => { cvModal.classList.remove('opacity-0'); modalContent.classList.remove('scale-95', 'opacity-0'); }, 10);
            document.getElementById('cv-form').reset(); document.getElementById('cv-form-message').innerHTML = "";
            const modalTitle = document.getElementById('cv-modal-title');
            modalTitle.textContent = jobTitle ? `×”×’×©×ª ××•×¢××“×•×ª ×œ××©×¨×ª "${jobTitle}"` : "×©×œ×™×—×ª ×§×•×¨×•×ª ×—×™×™× ×›×œ×œ×™×ª";
        }
        function closeCVModal() {
            modalContent.classList.add('scale-95', 'opacity-0'); cvModal.classList.add('opacity-0');
            setTimeout(() => { cvModal.classList.add('hidden'); document.body.style.overflow = 'auto'; }, 300);
        }

        // --- CV Form Submission ---
        async function handleCvFormSubmit(e) {
            e.preventDefault();
            const form = e.target;
            const msgEl = document.getElementById('cv-form-message');
            const submitBtn = document.getElementById('cv-submit-button');
            const submitText = document.getElementById('submit-text');
            const submitSpinner = document.getElementById('submit-spinner');
            const cvFile = form.cvFile.files[0];
            if (!cvFile) { msgEl.className = 'text-red-600'; msgEl.textContent = '×—×•×‘×” ×œ×”×¢×œ×•×ª ×§×•×‘×¥ ×§×•×¨×•×ª ×—×™×™×.'; return; }
            submitBtn.disabled = true; submitText.classList.add('hidden'); submitSpinner.classList.remove('hidden');
            msgEl.className = 'text-blue-600'; msgEl.textContent = '×©×•×œ×— ×¤×¨×˜×™×...';
            const storageRef = ref(storage, `cvs/${Date.now()}_${cvFile.name}`);
            try {
                await uploadBytes(storageRef, cvFile);
                const fileURL = await getDownloadURL(storageRef);
                const docData = { firstName: form.firstName.value.trim(), lastName: form.lastName.value.trim(), phone: form.phone.value.trim(), fileURL: fileURL, jobId: selectedJobId || null, jobTitle: selectedJobTitle || '×”×’×©×” ×›×œ×œ×™×ª', createdAt: serverTimestamp() };
                await addDoc(collection(db, "jobApplicants"), docData);
                msgEl.className = 'text-green-600'; msgEl.textContent = '×”×¤×¨×˜×™× × ×©×œ×—×• ×‘×”×¦×œ×—×”!';
                form.reset();
                setTimeout(closeCVModal, 2500);
            } catch (err) {
                console.error("Form submission error:", err);
                msgEl.className = 'text-red-600'; msgEl.textContent = '××™×¨×¢×” ×©×’×™××”. ×× × × ×¡×• ×©× ×™×ª.';
            } finally {
                submitBtn.disabled = false; submitText.classList.remove('hidden'); submitSpinner.classList.add('hidden');
            }
        }

        // --- Run All Initialization Logic ---
        document.addEventListener('DOMContentLoaded', async () => {
            loadComponent('menu.html', 'header-placeholder', () => {
                const mobileMenuButton = document.getElementById('mobile-menu-button');
                const mobileMenu = document.getElementById('mobile-menu');
                if (mobileMenuButton && mobileMenu) { mobileMenuButton.addEventListener('click', () => mobileMenu.classList.toggle('hidden')); }
            });
            loadComponent('footer.html', 'footer-placeholder');

            await loadCities();
            setupAutocomplete();

            const hotJobsQuery = query(collection(db, "jobs"), where("isHot", "==", true));
            createStorySlider({ containerId: '#hot-jobs-container', sliderClass: '.hot-jobs-slider', query: hotJobsQuery, noJobsMessage: '××™×Ÿ ×›×¨×’×¢ ××©×¨×•×ª ×—××•×ª', jobIconClass: 'fas fa-fire text-red-400' });
            
            const sevenDaysAgo = new Date(Date.now() - 7 * 24 * 60 * 60 * 1000);
            const newJobsQuery = query(collection(db, "jobs"), where("createdAt", ">=", sevenDaysAgo), orderBy("createdAt", "desc"));
            createStorySlider({ containerId: '#new-jobs-container', sliderClass: '.new-jobs-slider', query: newJobsQuery, noJobsMessage: '××™×Ÿ ××©×¨×•×ª ××”×©×‘×•×¢ ×”××—×¨×•×Ÿ', jobIconClass: 'fas fa-sparkles text-yellow-300' });
            
            setupScrollAnimations();
            
            document.getElementById('open-cv-modal').addEventListener('click', () => openCVModal());
            document.getElementById('close-cv-modal').addEventListener('click', closeCVModal);
            cvModal.addEventListener('click', (e) => { if (e.target === cvModal) closeCVModal(); });
            document.getElementById('cv-form').addEventListener('submit', handleCvFormSubmit);
            document.getElementById('search-form').addEventListener('submit', (e) => {
                e.preventDefault();
                const keyword = document.getElementById('keyword-search-input').value;
                const category = document.getElementById('category-select').value;
                const locations = Array.from(selectedLocations);
                console.log("Searching for:", { keyword, category, locations });
                alert(`××—×¤×©... ××™×œ×ª ××¤×ª×—: ${keyword}, ×ª×—×•×: ${category}, ××–×•×¨×™×: ${locations.join(', ')}`);
            });
        });
    </script>
</body>
</html>